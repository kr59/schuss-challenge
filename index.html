<!DOCTYPE html>
<html lang="de">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>ğŸ¯ Schussduell</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Outfit:wght@300;400;500;600;700;800&family=DM+Mono:wght@400;500&display=swap"
    rel="stylesheet">
  <!-- Firebase v9 Compat SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <style>
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BASE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    *,
    *::before,
    *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      -webkit-tap-highlight-color: transparent
    }

    html,
    body {
      height: 100%;
      overflow: hidden
    }

    body {
      height: 100%;
      background: #0e1208;
      font-family: 'Outfit', sans-serif;
      font-size: 16px;
      display: flex;
      flex-direction: column;
      align-items: center;
      overflow: hidden;
      color: #e8e8e0;
    }

    /* Layered background */
    body::before {
      content: '';
      position: fixed;
      inset: 0;
      z-index: 0;
      background:
        radial-gradient(ellipse 80% 60% at 50% -10%, rgba(90, 140, 30, .18) 0%, transparent 60%),
        radial-gradient(ellipse 60% 40% at 80% 100%, rgba(40, 60, 15, .25) 0%, transparent 50%),
        linear-gradient(175deg, #0a0f06 0%, #111808 40%, #0e1408 100%);
    }

    /* Grain overlay */
    body::after {
      content: '';
      position: fixed;
      inset: 0;
      z-index: 0;
      pointer-events: none;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.75' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.04'/%3E%3C/svg%3E");
      background-size: 180px 180px;
      opacity: 0.6;
    }

    .screen {
      display: none;
      flex-direction: column;
      align-items: center;
      width: 100%;
      height: 100%;
      position: relative;
      z-index: 1;
      overflow-y: auto;
      overflow-x: hidden;
    }

    .screen.active {
      display: flex;
    }

    ::-webkit-scrollbar {
      width: 2px;
    }

    ::-webkit-scrollbar-thumb {
      background: #2a4010;
      border-radius: 2px;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HEADER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .hdr {
      width: 100%;
      flex-shrink: 0;
      padding: 14px 20px 0;
      background: linear-gradient(180deg, rgba(8, 14, 4, .97) 0%, rgba(12, 18, 6, .92) 100%);
      border-bottom: 1px solid rgba(100, 160, 40, .2);
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
    }

    .hdr::after {
      content: '';
      position: absolute;
      bottom: -1px;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent, rgba(140, 200, 60, .35) 30%, rgba(140, 200, 60, .35) 70%, transparent);
    }

    .logo {
      font-family: 'Bebas Neue', cursive;
      font-size: clamp(2rem, 8vw, 2.8rem);
      letter-spacing: .16em;
      color: #f0e0a0;
      text-shadow: 0 2px 12px rgba(0, 0, 0, .9), 0 0 30px rgba(200, 170, 60, .15);
      line-height: 1;
    }

    .logo em {
      color: #8ecf40;
      font-style: normal;
    }

    .logo-tag {
      font-size: .6rem;
      letter-spacing: .4em;
      text-transform: uppercase;
      color: rgba(140, 200, 60, .55);
      margin-top: 2px;
      font-weight: 500;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HEADER TOP ROW  (streak left Â· logo center)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .hdr-top {
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 2px;
      margin-bottom: 4px;
    }

    .streak-corner {
      display: flex;
      align-items: center;
      gap: 5px;
      background: rgba(170, 90, 255, .1);
      border: 1px solid rgba(170, 90, 255, .2);
      border-radius: 8px;
      padding: 4px 9px 4px 7px;
      cursor: default;
      transition: background .2s;
      flex-shrink: 0;
    }

    .streak-corner:hover {
      background: rgba(170, 90, 255, .16);
    }

    .sc-fire {
      font-size: .85rem;
      line-height: 1;
    }

    .sc-inf {
      display: flex;
      flex-direction: column;
    }

    .sc-n {
      font-family: 'Bebas Neue', cursive;
      font-size: 1rem;
      line-height: 1;
      color: #c880ff;
      text-shadow: 0 0 10px rgba(180, 90, 255, .35);
    }

    .sc-lbl {
      font-size: .38rem;
      letter-spacing: .16em;
      text-transform: uppercase;
      color: rgba(190, 140, 255, .35);
      font-weight: 600;
      line-height: 1;
      margin-top: 1px;
    }

    /* mirrors streak width so logo stays centered */
    .hdr-spacer {
      flex-shrink: 0;
      visibility: hidden;
      pointer-events: none;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   WEAPON TABS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .weapon-tabs {
      display: flex;
      width: 100%;
      margin-top: 12px;
      border-bottom: 1px solid rgba(255, 255, 255, .08);
    }

    .weapon-tab {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 10px 8px 11px;
      cursor: pointer;
      position: relative;
      transition: background .18s;
      -webkit-tap-highlight-color: transparent;
    }

    .weapon-tab:active {
      background: rgba(255, 255, 255, .03);
    }

    .weapon-tab::after {
      content: '';
      position: absolute;
      bottom: -1px;
      left: 16%;
      right: 16%;
      height: 3px;
      background: #8ecf40;
      border-radius: 3px 3px 0 0;
      transform: scaleX(0);
      transition: transform .22s cubic-bezier(.34, 1.56, .64, 1);
    }

    .weapon-tab.active::after {
      transform: scaleX(1);
    }

    .wt-name {
      font-size: .88rem;
      font-weight: 700;
      letter-spacing: .07em;
      text-transform: uppercase;
      color: rgba(255, 255, 255, .32);
      transition: color .2s;
      line-height: 1;
    }

    .weapon-tab.active .wt-name {
      color: #c8ee80;
    }

    /* Separator line between tabs */
    .weapon-tabs .weapon-tab:not(:last-child) {
      border-right: 1px solid rgba(255, 255, 255, .06);
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STAT CHIPS IN HEADER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .hdr-chips {
      display: flex;
      gap: 8px;
      margin-top: 10px;
      width: 100%;
      max-width: 400px;
      justify-content: center;
    }

    .chip {
      display: flex;
      flex-direction: column;
      align-items: center;
      background: rgba(0, 0, 0, .45);
      border: 1px solid rgba(255, 255, 255, .07);
      border-radius: 10px;
      padding: 6px 14px;
      min-width: 76px;
    }

    .chip.green {
      border-color: rgba(100, 180, 40, .25);
      background: rgba(60, 120, 10, .2);
    }

    .chip.red {
      border-color: rgba(180, 60, 40, .25);
      background: rgba(100, 20, 10, .2);
    }

    .chip.gold {
      border-color: rgba(180, 140, 20, .25);
      background: rgba(100, 70, 5, .2);
    }

    .chip-label {
      font-size: .52rem;
      letter-spacing: .2em;
      text-transform: uppercase;
      color: rgba(255, 255, 255, .3);
      font-weight: 600;
    }

    .chip-val {
      font-family: 'Bebas Neue', cursive;
      font-size: 1.7rem;
      line-height: 1.1;
      color: #f0e0a0;
    }

    .chip-sub {
      font-size: .45rem;
      letter-spacing: .12em;
      text-transform: uppercase;
      color: rgba(255, 255, 255, .2);
    }

    .chip.gold .chip-val {
      color: #ffc840;
    }

    .chip.green .chip-val {
      color: #a8e060;
    }

    .chip.red .chip-val {
      color: #f08070;
    }

    @keyframes pulse {
      from {
        opacity: 1
      }

      to {
        opacity: .45
      }
    }

    .chip-val.low {
      color: #ff5030 !important;
      animation: pulse .6s ease infinite alternate;
    }

    .hdr-tag {
      font-size: .5rem;
      letter-spacing: .28em;
      text-transform: uppercase;
      color: rgba(140, 200, 60, .6);
      background: rgba(100, 160, 30, .08);
      border: 1px solid rgba(100, 160, 30, .18);
      border-radius: 4px;
      padding: 3px 12px;
      margin: 8px 0 10px;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   COMMON CARDS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .content {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 100%;
      max-width: 420px;
      padding: 16px 18px;
      gap: 13px;
    }

    .card {
      width: 100%;
      background: rgba(0, 0, 0, .5);
      border: 1px solid rgba(255, 255, 255, .07);
      border-radius: 14px;
      padding: 14px 16px;
    }

    .card-hd {
      font-size: .55rem;
      letter-spacing: .3em;
      text-transform: uppercase;
      color: rgba(255, 255, 255, .28);
      font-weight: 600;
      margin-bottom: 12px;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SHOT COUNT SELECTOR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .sc-row {
      display: flex;
      gap: 8px;
    }

    .scb {
      flex: 1;
      padding: 11px 4px;
      background: rgba(255, 255, 255, .03);
      border: 1px solid rgba(255, 255, 255, .09);
      border-radius: 10px;
      cursor: pointer;
      transition: all .18s;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 2px;
    }

    .scb-n {
      font-family: 'Bebas Neue', cursive;
      font-size: 1.6rem;
      color: rgba(255, 255, 255, .55);
      line-height: 1;
    }

    .scb-u {
      font-size: .46rem;
      letter-spacing: .18em;
      text-transform: uppercase;
      color: rgba(255, 255, 255, .2);
    }

    .scb.active {
      background: rgba(110, 170, 40, .14);
      border-color: #6aaa28;
      box-shadow: 0 0 14px rgba(110, 170, 40, .15);
    }

    .scb.active .scb-n {
      color: #c8ee80;
    }

    .scb.active .scb-u {
      color: rgba(160, 220, 80, .5);
    }

    /* 5-shot burst button */
    .btn-burst {
      width: 100%;
      padding: 11px 16px;
      font-family: 'Outfit', sans-serif;
      font-size: .88rem;
      font-weight: 700;
      letter-spacing: .05em;
      color: rgba(120, 200, 255, .7);
      background: rgba(40, 100, 200, .06);
      border: 1px solid rgba(80, 150, 255, .2);
      border-radius: 10px;
      cursor: pointer;
      transition: all .2s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .btn-burst.on {
      color: #70c8ff;
      background: rgba(40, 120, 220, .15);
      border-color: rgba(80, 160, 255, .4);
      box-shadow: 0 0 12px rgba(80, 160, 255, .12);
    }

    .btn-burst:active {
      background: rgba(40, 100, 200, .18);
    }

    .burst-badge {
      font-size: .52rem;
      letter-spacing: .18em;
      text-transform: uppercase;
      padding: 1px 6px;
      border-radius: 3px;
      background: rgba(80, 160, 255, .15);
      border: 1px solid rgba(80, 160, 255, .3);
      color: rgba(120, 190, 255, .7);
      font-weight: 700;
    }

    .dist-row {
      display: flex;
      gap: 8px;
    }

    .db {
      flex: 1;
      padding: 13px 4px;
      background: rgba(255, 255, 255, .03);
      border: 1px solid rgba(255, 255, 255, .09);
      border-radius: 10px;
      cursor: pointer;
      transition: all .18s;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 3px;
    }

    .db.hidden {
      display: none;
    }

    .db-n {
      font-family: 'Bebas Neue', cursive;
      font-size: 1.6rem;
      color: rgba(255, 255, 255, .55);
      line-height: 1;
    }

    .db-u {
      font-size: .48rem;
      letter-spacing: .2em;
      text-transform: uppercase;
      color: rgba(255, 255, 255, .22);
    }

    .db.active {
      background: rgba(110, 170, 40, .14);
      border-color: #6aaa28;
      box-shadow: 0 0 14px rgba(110, 170, 40, .15);
    }

    .db.active .db-n {
      color: #c8ee80;
    }

    .db.active .db-u {
      color: rgba(160, 220, 80, .5);
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INFO / HINT STRIPS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .info-row {
      display: flex;
      align-items: flex-start;
      gap: 10px;
      padding: 10px 14px;
      background: rgba(20, 40, 80, .25);
      border: 1px solid rgba(80, 130, 200, .15);
      border-radius: 10px;
      width: 100%;
    }

    .info-ico {
      font-size: 1.1rem;
      margin-top: 1px;
      flex-shrink: 0;
    }

    .info-txt {
      font-size: .85rem;
      color: rgba(180, 205, 240, .55);
      line-height: 1.45;
      font-weight: 400;
    }

    .info-txt b {
      color: rgba(200, 225, 255, .75);
      font-weight: 600;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DIFFICULTY BUTTONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .diff-row {
      display: flex;
      gap: 8px;
    }

    .dif {
      flex: 1;
      padding: 13px 6px;
      background: rgba(255, 255, 255, .03);
      border: 1px solid rgba(255, 255, 255, .08);
      border-radius: 10px;
      cursor: pointer;
      transition: background .2s, border-color .2s, box-shadow .2s;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
    }

    .dif-ico {
      font-size: 1.4rem;
      line-height: 1;
    }

    .dif-name {
      font-size: .82rem;
      font-weight: 700;
      color: rgba(255, 255, 255, .45);
      letter-spacing: .04em;
    }

    .dif-desc {
      font-size: .5rem;
      letter-spacing: .12em;
      text-transform: uppercase;
      color: rgba(255, 255, 255, .2);
    }

    .dif.easy {
      border-color: rgba(80, 180, 80, .15);
    }

    .dif.easy.active {
      background: rgba(50, 140, 50, .16);
      border-color: #46b040;
      box-shadow: 0 0 14px rgba(70, 176, 64, .15);
    }

    .dif.easy.active .dif-name {
      color: #80d860;
    }

    .dif.real {
      border-color: rgba(80, 130, 220, .15);
    }

    .dif.real.active {
      background: rgba(50, 100, 200, .14);
      border-color: #4882d8;
      box-shadow: 0 0 14px rgba(72, 130, 216, .15);
    }

    .dif.real.active .dif-name {
      color: #70aaf0;
    }

    .dif.hard {
      border-color: rgba(200, 60, 40, .15);
    }

    .dif.hard.active {
      background: rgba(180, 35, 25, .16);
      border-color: #c82818;
      box-shadow: 0 0 14px rgba(200, 40, 24, .18);
    }

    .dif.hard.active .dif-name {
      color: #f07060;
    }

    .dif.elite {
      border-color: rgba(220, 170, 20, .15);
    }

    .dif.elite.active {
      background: linear-gradient(135deg, rgba(120, 80, 0, .25), rgba(80, 50, 0, .2));
      border-color: #d4a820;
      box-shadow: 0 0 18px rgba(212, 168, 32, .25), inset 0 0 12px rgba(212, 168, 32, .06);
    }

    .dif.elite.active .dif-name {
      color: #f0c840;
    }

    .dif.elite.active .dif-ico {
      filter: drop-shadow(0 0 4px rgba(255, 210, 50, .6));
    }

    /* Diff badge */
    .diff-badge {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      font-size: .52rem;
      letter-spacing: .22em;
      text-transform: uppercase;
      border-radius: 5px;
      padding: 2px 10px;
      margin-top: 5px;
      border: 1px solid;
      font-weight: 600;
    }

    .diff-badge.easy {
      color: #80d860;
      border-color: rgba(128, 216, 96, .3);
      background: rgba(70, 176, 64, .08);
    }

    .diff-badge.real {
      color: #70aaf0;
      border-color: rgba(112, 170, 240, .3);
      background: rgba(72, 130, 216, .08);
    }

    .diff-badge.hard {
      color: #f07060;
      border-color: rgba(240, 112, 96, .3);
      background: rgba(200, 40, 24, .08);
    }

    .diff-badge.elite {
      color: #f0c840;
      border-color: rgba(240, 200, 64, .4);
      background: rgba(160, 110, 0, .15);
      box-shadow: 0 0 8px rgba(240, 200, 64, .15);
    }

    /* Weapon badge in battle header */
    .weapon-badge {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      font-size: .5rem;
      letter-spacing: .2em;
      text-transform: uppercase;
      border-radius: 4px;
      padding: 2px 9px;
      margin-top: 3px;
      border: 1px solid;
      font-weight: 700;
    }

    .weapon-badge.lg {
      color: #70d8f8;
      border-color: rgba(112, 216, 248, .3);
      background: rgba(40, 140, 200, .08);
    }

    .weapon-badge.kk {
      color: #f8c870;
      border-color: rgba(248, 200, 112, .3);
      background: rgba(160, 100, 20, .08);
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ACTION BUTTONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .actions {
      width: 100%;
      max-width: 420px;
      padding: 0 18px 18px;
      display: flex;
      flex-direction: column;
      gap: 9px;
      flex-shrink: 0;
    }

    .btn-fire {
      width: 100%;
      padding: 18px 20px;
      font-family: 'Bebas Neue', cursive;
      font-size: 2.2rem;
      letter-spacing: .2em;
      color: #0c1008;
      background: linear-gradient(175deg, #dab228 0%, #a07c10 48%, #c8981c 100%);
      border: none;
      border-radius: 13px;
      cursor: pointer;
      position: relative;
      overflow: hidden;
      box-shadow: 0 5px 0 #5a3c08, 0 8px 24px rgba(180, 140, 0, .25), inset 0 1px 0 rgba(255, 255, 255, .3);
      transition: transform .1s, box-shadow .1s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      will-change: transform;
    }

    .btn-fire::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 46%;
      background: rgba(255, 255, 255, .15);
      border-radius: 11px 11px 50% 50%;
    }

    .btn-fire:active {
      transform: translateY(4px);
      box-shadow: 0 1px 0 #5a3c08, 0 3px 8px rgba(180, 140, 0, .15), inset 0 1px 0 rgba(255, 255, 255, .3);
    }

    .btn-fire:disabled {
      background: linear-gradient(180deg, #282828, #1a1a1a);
      color: rgba(255, 255, 255, .2);
      box-shadow: 0 3px 0 #111;
      cursor: not-allowed;
    }

    .btn-sec {
      width: 100%;
      padding: 12px 16px;
      font-family: 'Outfit', sans-serif;
      font-size: .9rem;
      font-weight: 600;
      letter-spacing: .06em;
      color: rgba(255, 100, 80, .55);
      background: rgba(255, 50, 30, .04);
      border: 1px solid rgba(255, 50, 30, .16);
      border-radius: 10px;
      cursor: pointer;
      transition: background .2s;
    }

    .btn-sec:active {
      background: rgba(255, 50, 30, .1);
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BATTLE SCREEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    #screenBattle .content {
      padding: 10px 18px;
      gap: 9px;
    }

    .target-wrap {
      position: relative;
      flex-shrink: 0;
      width: 100%;
      display: flex;
      justify-content: center;
    }

    .target-shadow {
      position: absolute;
      bottom: -10px;
      left: 50%;
      transform: translateX(-50%);
      width: 80%;
      height: 18px;
      background: radial-gradient(ellipse, rgba(0, 0, 0, .6) 0%, transparent 75%);
      filter: blur(6px);
    }

    #targetCanvas {
      display: block;
      border-radius: 50%;
      box-shadow: 0 0 0 1px rgba(180, 160, 100, .25), 0 12px 40px rgba(0, 0, 0, .6);
      will-change: transform;
    }

    /* Live dual-score bar */
    .live-score-bar {
      width: 100%;
      background: rgba(0, 0, 0, .5);
      border: 1px solid rgba(180, 55, 40, .22);
      border-radius: 12px;
      padding: 10px 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }

    .lsb-block {
      display: flex;
      flex-direction: column;
      align-items: center;
      flex: 1;
    }

    .lsb-lbl {
      font-size: .48rem;
      letter-spacing: .22em;
      text-transform: uppercase;
      color: rgba(255, 255, 255, .28);
      font-weight: 600;
      margin-bottom: 2px;
    }

    .lsb-val {
      font-family: 'DM Mono', monospace;
      font-size: 1.55rem;
      font-weight: 500;
      line-height: 1;
    }

    .lsb-val.dec {
      color: #f08070;
    }

    .lsb-val.int {
      color: rgba(240, 130, 110, .5);
    }

    .lsb-val.proj {
      color: rgba(255, 200, 80, .45);
      font-size: 1.1rem;
    }

    .lsb-divider {
      width: 1px;
      height: 32px;
      background: rgba(255, 255, 255, .08);
      flex-shrink: 0;
    }

    /* Shot progress bar */
    .shot-progress {
      width: 100%;
      display: flex;
      flex-direction: column;
      gap: 5px;
    }

    .sp-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .sp-lbl {
      font-size: .5rem;
      letter-spacing: .2em;
      text-transform: uppercase;
      color: rgba(255, 195, 60, .38);
      font-weight: 600;
    }

    .sp-count {
      font-family: 'DM Mono', monospace;
      font-size: .9rem;
      color: #ffc840;
    }

    .sp-count.low {
      color: #ff5030;
    }

    .sp-bar {
      width: 100%;
      height: 6px;
      background: rgba(255, 255, 255, .07);
      border-radius: 3px;
      overflow: hidden;
    }

    .sp-fill {
      height: 100%;
      border-radius: 3px;
      transition: width .2s ease, background .3s;
      background: linear-gradient(90deg, #5a9020, #a0d030);
      will-change: width;
    }

    .sp-fill.low {
      background: linear-gradient(90deg, #8a1010, #e04040);
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MATCH TIMER HUD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .match-timer-box {
      display: flex;
      align-items: center;
      gap: 6px;
      background: rgba(0, 0, 0, .45);
      border: 1px solid rgba(255, 200, 60, .18);
      border-radius: 9px;
      padding: 4px 11px;
      margin-top: 6px;
      transition: border-color .3s;
    }

    .match-timer-box.warning {
      border-color: rgba(255, 80, 40, .5);
      animation: timerPulse .8s ease infinite alternate;
    }

    @keyframes timerPulse {
      from {
        background: rgba(0, 0, 0, .45)
      }

      to {
        background: rgba(120, 20, 10, .25)
      }
    }

    .mt-ico {
      font-size: .85rem;
      line-height: 1;
    }

    .mt-inf {
      display: flex;
      flex-direction: column;
    }

    .mt-lbl {
      font-size: .38rem;
      letter-spacing: .18em;
      text-transform: uppercase;
      color: rgba(255, 200, 60, .4);
      font-weight: 600;
      line-height: 1;
      margin-top: 1px;
    }

    .mt-val {
      font-family: 'DM Mono', monospace;
      font-size: .95rem;
      font-weight: 500;
      color: #ffc840;
      line-height: 1;
      text-shadow: 0 0 8px rgba(255, 180, 0, .3);
    }

    .match-timer-box.warning .mt-val {
      color: #ff5030;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DISCIPLINE TABS (under weapon tabs)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .disc-tabs {
      display: flex;
      width: 100%;
      gap: 6px;
      padding: 10px 0 0;
    }

    .disc-tab {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 9px 6px 10px;
      cursor: pointer;
      background: rgba(255, 255, 255, .02);
      border: 1px solid rgba(255, 255, 255, .07);
      border-radius: 10px;
      transition: background .2s, border-color .2s, box-shadow .2s;
      -webkit-tap-highlight-color: transparent;
    }

    .disc-tab:active {
      opacity: .75;
    }

    .dt-name {
      font-size: .8rem;
      font-weight: 800;
      letter-spacing: .05em;
      text-transform: uppercase;
      color: rgba(255, 255, 255, .3);
      transition: color .2s;
      line-height: 1;
    }

    .dt-desc {
      font-size: .44rem;
      letter-spacing: .14em;
      text-transform: uppercase;
      color: rgba(255, 255, 255, .15);
      margin-top: 3px;
      font-weight: 600;
    }

    .disc-tab.active {
      background: rgba(110, 170, 40, .14);
      border-color: #6aaa28;
      box-shadow: 0 0 14px rgba(110, 170, 40, .15);
    }

    .disc-tab.active .dt-name {
      color: #c8ee80;
    }

    .disc-tab.active .dt-desc {
      color: rgba(160, 220, 80, .5);
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   POSITION BAR (3Ã—20)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .pos-bar {
      display: none;
      /* shown only in 3x20 mode */
      width: 100%;
      flex-shrink: 0;
      padding: 8px 18px 0;
      justify-content: center;
      gap: 6px;
    }

    .pos-bar.visible {
      display: flex;
    }

    .pos-item {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 3px;
      padding: 8px 4px 9px;
      background: rgba(0, 0, 0, .4);
      border: 1px solid rgba(255, 255, 255, .07);
      border-radius: 10px;
      transition: all .25s;
      position: relative;
      overflow: hidden;
    }

    .pos-item.done {
      background: rgba(50, 120, 20, .12);
      border-color: rgba(100, 180, 40, .3);
    }

    .pos-item.active {
      background: rgba(90, 160, 30, .2);
      border-color: #7aba30;
      box-shadow: 0 0 18px rgba(100, 190, 40, .25), inset 0 1px 0 rgba(255, 255, 255, .08);
    }

    .pos-item::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 10%;
      right: 10%;
      height: 2px;
      background: #8ecf40;
      border-radius: 2px 2px 0 0;
      transform: scaleX(0);
      transition: transform .3s cubic-bezier(.34, 1.56, .64, 1);
    }

    .pos-item.active::after {
      transform: scaleX(1);
    }

    .pi-ico {
      font-size: 1.2rem;
      line-height: 1;
    }

    .pi-name {
      font-size: .62rem;
      font-weight: 800;
      letter-spacing: .08em;
      text-transform: uppercase;
      color: rgba(255, 255, 255, .28);
      transition: color .2s;
    }

    .pos-item.active .pi-name {
      color: #c8ee80;
    }

    .pos-item.done .pi-name {
      color: rgba(140, 200, 80, .5);
    }

    .pi-shots {
      font-family: 'DM Mono', monospace;
      font-size: .7rem;
      color: rgba(255, 255, 255, .2);
      transition: color .2s;
    }

    .pos-item.active .pi-shots {
      color: rgba(200, 240, 120, .6);
    }

    .pos-item.done .pi-shots {
      color: rgba(100, 180, 60, .4);
    }

    .pi-done-check {
      position: absolute;
      top: 5px;
      right: 6px;
      font-size: .65rem;
      opacity: 0;
      transition: opacity .2s;
    }

    .pos-item.done .pi-done-check {
      opacity: .7;
    }

    @keyframes posTransition {
      0% {
        transform: scale(1);
      }

      40% {
        transform: scale(1.04);
      }

      100% {
        transform: scale(1);
      }
    }

    .pos-item.transition {
      animation: posTransition .4s ease;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SHOT LOG â€“ scrollable, grouped
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .shot-log-wrap {
      width: 100%;
      max-height: 88px;
      /* ~3 rows of pills */
      overflow-y: auto;
      overflow-x: hidden;
    }

    .shot-log-wrap::-webkit-scrollbar {
      width: 2px;
    }

    .shot-log-wrap::-webkit-scrollbar-thumb {
      background: rgba(140, 200, 60, .2);
      border-radius: 2px;
    }

    .sl-group {
      width: 100%;
      display: flex;
      flex-direction: column;
      gap: 3px;
      margin-bottom: 4px;
    }

    .sl-group-hd {
      font-size: .44rem;
      letter-spacing: .24em;
      text-transform: uppercase;
      color: rgba(140, 200, 60, .35);
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 0 1px;
    }

    .sl-group-hd::after {
      content: '';
      flex: 1;
      height: 1px;
      background: rgba(140, 200, 60, .12);
    }

    .sl-group-pills {
      display: flex;
      gap: 3px;
      flex-wrap: wrap;
    }

    /* legacy flat log (non-3x20) */
    .shot-log {
      width: 100%;
      display: flex;
      gap: 4px;
      flex-wrap: wrap;
      min-height: 22px;
    }

    .sl-pill {
      font-family: 'DM Mono', monospace;
      font-size: .65rem;
      font-weight: 500;
      padding: 2px 6px;
      border-radius: 4px;
      border: 1px solid;
      animation: fadeUp .2s ease forwards;
    }

    .sl-pill.x {
      color: #ffd040;
      border-color: rgba(255, 208, 64, .4);
      background: rgba(255, 208, 64, .1);
    }

    .sl-pill.hi {
      color: #a0e060;
      border-color: rgba(160, 224, 96, .3);
      background: rgba(100, 180, 40, .1);
    }

    .sl-pill.mid {
      color: #70aaf0;
      border-color: rgba(112, 170, 240, .25);
      background: rgba(70, 120, 200, .1);
    }

    .sl-pill.lo {
      color: rgba(255, 255, 255, .4);
      border-color: rgba(255, 255, 255, .1);
      background: rgba(255, 255, 255, .04);
    }

    .sl-pill.miss {
      color: rgba(255, 100, 80, .5);
      border-color: rgba(255, 80, 60, .2);
      background: rgba(255, 50, 30, .06);
    }

    /* Last shot info box */
    .last-shot-box {
      width: 100%;
      padding: 9px 13px;
      background: rgba(0, 0, 0, .38);
      border: 1px solid rgba(255, 255, 255, .07);
      border-radius: 10px;
    }

    .ls-txt {
      font-size: .86rem;
      color: rgba(180, 210, 240, .5);
      line-height: 1.4;
    }

    .ls-txt b {
      color: rgba(200, 225, 255, .75);
      font-weight: 700;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ENTRY SCREEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    #screenEntry {
      justify-content: flex-start;
    }

    #screenEntry .content {
      padding: 14px 18px;
      gap: 13px;
    }

    .bot-result {
      width: 100%;
      background: linear-gradient(135deg, rgba(40, 5, 5, .7), rgba(25, 0, 0, .8));
      border: 1px solid rgba(180, 50, 40, .3);
      border-radius: 14px;
      padding: 16px;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .bot-result::before {
      content: '';
      position: absolute;
      inset: 0;
      background: radial-gradient(ellipse 70% 50% at 50% 100%, rgba(180, 40, 30, .12) 0%, transparent 70%);
      pointer-events: none;
    }

    .br-lbl {
      font-size: .55rem;
      letter-spacing: .3em;
      text-transform: uppercase;
      color: rgba(240, 110, 90, .45);
      font-weight: 600;
      margin-bottom: 6px;
    }

    .br-pts {
      font-family: 'Bebas Neue', cursive;
      font-size: 3.2rem;
      color: #f08070;
      line-height: 1;
      text-shadow: 0 0 24px rgba(240, 100, 80, .35);
    }

    .br-sub {
      font-size: .78rem;
      color: rgba(255, 255, 255, .28);
      margin-top: 4px;
      font-weight: 400;
    }

    .entry-card2 {
      width: 100%;
      background: rgba(0, 0, 0, .48);
      border: 1px solid rgba(110, 170, 40, .2);
      border-radius: 14px;
      padding: 15px;
    }

    .ec-lbl {
      font-size: .55rem;
      letter-spacing: .28em;
      text-transform: uppercase;
      color: rgba(255, 255, 255, .25);
      font-weight: 600;
      margin-bottom: 12px;
    }

    .ec-row {
      display: flex;
      gap: 8px;
      align-items: stretch;
    }

    .score-inp {
      flex: 1;
      padding: 13px 14px;
      font-family: 'DM Mono', monospace;
      font-size: 1.9rem;
      font-weight: 500;
      letter-spacing: .05em;
      background: rgba(255, 255, 255, .05);
      border: 1px solid rgba(110, 170, 40, .28);
      border-radius: 9px;
      color: #b8e870;
      outline: none;
      text-align: center;
      appearance: none;
      -webkit-appearance: none;
      -moz-appearance: textfield;
      transition: border-color .2s, box-shadow .2s;
    }

    .score-inp:focus {
      border-color: #7ab030;
      box-shadow: 0 0 14px rgba(120, 180, 40, .18);
    }

    .score-inp::placeholder {
      color: rgba(255, 255, 255, .15);
    }

    .btn-calc {
      padding: 13px 16px;
      font-family: 'Outfit', sans-serif;
      font-weight: 700;
      font-size: .9rem;
      letter-spacing: .05em;
      background: linear-gradient(135deg, #5a9020, #3a6010);
      color: #d8f8a0;
      border: none;
      border-radius: 9px;
      cursor: pointer;
      box-shadow: 0 3px 0 #1a3008;
      transition: transform .1s, box-shadow .1s;
      white-space: nowrap;
    }

    .btn-calc:active {
      transform: translateY(2px);
      box-shadow: 0 1px 0 #1a3008;
    }

    /* Auto-calc Ganze hint */
    .auto-int {
      margin-top: 7px;
      font-size: .78rem;
      color: rgba(200, 255, 150, .35);
      font-family: 'DM Mono', monospace;
      letter-spacing: .04em;
      transition: color .2s;
    }

    .auto-int.active {
      color: rgba(200, 255, 150, .65);
    }

    .auto-int span {
      font-weight: 700;
      color: #a0e060;
    }

    .divider {
      width: 100%;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .divider-line {
      flex: 1;
      height: 1px;
      background: rgba(255, 255, 255, .08);
    }

    .divider-txt {
      font-size: .58rem;
      letter-spacing: .22em;
      text-transform: uppercase;
      color: rgba(255, 255, 255, .18);
      font-weight: 600;
    }

    .quick-pair {
      width: 100%;
      display: flex;
      gap: 9px;
    }

    .btn-win {
      flex: 1;
      padding: 16px 8px;
      font-family: 'Outfit', sans-serif;
      font-size: 1rem;
      font-weight: 800;
      letter-spacing: .04em;
      color: #0a1206;
      background: linear-gradient(175deg, #90d838, #5a9c18);
      border: none;
      border-radius: 12px;
      cursor: pointer;
      box-shadow: 0 4px 0 #245008, 0 6px 18px rgba(100, 190, 30, .22), inset 0 1px 0 rgba(255, 255, 255, .25);
      transition: transform .1s, box-shadow .1s;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 3px;
    }

    .btn-win:active {
      transform: translateY(3px);
      box-shadow: 0 1px 0 #245008;
    }

    .btn-lose {
      flex: 1;
      padding: 16px 8px;
      font-family: 'Outfit', sans-serif;
      font-size: 1rem;
      font-weight: 800;
      letter-spacing: .04em;
      color: #fff0ee;
      background: linear-gradient(175deg, #982820, #621410);
      border: none;
      border-radius: 12px;
      cursor: pointer;
      box-shadow: 0 4px 0 #240808, 0 6px 18px rgba(160, 35, 25, .22), inset 0 1px 0 rgba(255, 255, 255, .12);
      transition: transform .1s, box-shadow .1s;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 3px;
    }

    .btn-lose:active {
      transform: translateY(3px);
      box-shadow: 0 1px 0 #240808;
    }

    .qb-ico {
      font-size: 1.5rem;
      line-height: 1;
    }

    .qb-main {
      font-size: 1rem;
      font-weight: 800;
      letter-spacing: .03em;
    }

    .qb-sub {
      font-size: .62rem;
      opacity: .5;
      font-weight: 500;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   GAME OVER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    #screenOver {
      justify-content: center;
      gap: 16px;
      text-align: center;
      padding: 28px 22px;
      overflow-y: auto;
    }

    .go-emoji {
      font-size: 4.5rem;
      line-height: 1;
    }

    .go-title {
      font-family: 'Bebas Neue', cursive;
      font-size: clamp(2.8rem, 12vw, 4.5rem);
      letter-spacing: .1em;
      line-height: 1;
    }

    .go-title.win {
      color: #90d838;
      text-shadow: 0 0 32px rgba(144, 216, 56, .35);
    }

    .go-title.lose {
      color: #f06050;
      text-shadow: 0 0 32px rgba(240, 96, 80, .35);
    }

    .go-title.draw {
      color: #f0c838;
      text-shadow: 0 0 32px rgba(240, 200, 56, .35);
    }

    .go-sub {
      color: rgba(255, 255, 255, .4);
      font-size: 1rem;
      max-width: 280px;
      line-height: 1.45;
      font-weight: 400;
    }

    .go-scores {
      display: flex;
      align-items: stretch;
      gap: 0;
      background: rgba(0, 0, 0, .48);
      border: 1px solid rgba(255, 255, 255, .08);
      border-radius: 16px;
      overflow: hidden;
    }

    .gs-block {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 3px;
      padding: 16px 28px;
    }

    .gs-block:first-child {
      border-right: 1px solid rgba(255, 255, 255, .07);
    }

    .gs-who {
      font-size: .52rem;
      letter-spacing: .22em;
      text-transform: uppercase;
      color: rgba(255, 255, 255, .28);
      font-weight: 600;
    }

    .gs-num {
      font-family: 'DM Mono', monospace;
      font-size: 2.8rem;
      font-weight: 500;
      line-height: 1;
    }

    .gs-num.you {
      color: #b0e870;
    }

    .gs-num.bot {
      color: #f08070;
    }

    .gs-unit {
      font-size: .6rem;
      color: rgba(255, 255, 255, .25);
      letter-spacing: .15em;
      text-transform: uppercase;
      font-weight: 500;
    }

    .gs-sep {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0 4px;
      font-family: 'Bebas Neue', cursive;
      font-size: 1.6rem;
      color: rgba(255, 255, 255, .12);
      background: rgba(0, 0, 0, .3);
    }

    .go-reason {
      font-size: .62rem;
      color: rgba(255, 255, 255, .2);
      letter-spacing: .18em;
      text-transform: uppercase;
      font-weight: 500;
    }

    .go-margin {
      font-size: .82rem;
      font-weight: 600;
      letter-spacing: .04em;
      padding: 5px 16px;
      border-radius: 20px;
      border: 1px solid;
    }

    .go-margin.win {
      color: #90d838;
      border-color: rgba(144, 216, 56, .3);
      background: rgba(100, 200, 40, .08);
    }

    .go-margin.lose {
      color: #f06050;
      border-color: rgba(240, 96, 80, .3);
      background: rgba(200, 60, 40, .08);
    }

    .go-margin.draw {
      color: #f0c838;
      border-color: rgba(240, 200, 56, .3);
      background: rgba(200, 160, 40, .08);
    }

    /* Dual score display */
    .dual-score {
      display: flex;
      align-items: baseline;
      justify-content: center;
      gap: 10px;
      flex-wrap: wrap;
    }

    .ds-main {
      font-family: 'DM Mono', monospace;
      font-size: 2.8rem;
      font-weight: 500;
      line-height: 1;
    }

    .ds-sep {
      font-size: 1rem;
      color: rgba(255, 255, 255, .2);
      font-weight: 300;
    }

    .ds-int {
      font-family: 'DM Mono', monospace;
      font-size: 1.6rem;
      font-weight: 400;
      color: rgba(255, 255, 255, .38);
      line-height: 1;
    }

    .ds-int-lbl {
      font-size: .5rem;
      letter-spacing: .18em;
      text-transform: uppercase;
      color: rgba(255, 255, 255, .22);
      display: block;
      text-align: center;
      margin-top: 1px;
    }

    .ds-dec-lbl {
      font-size: .5rem;
      letter-spacing: .18em;
      text-transform: uppercase;
      display: block;
      text-align: center;
      margin-top: 1px;
    }

    .dual-wrap {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 16px;
    }

    .dual-col {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FX
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    #muzzleFlash {
      position: fixed;
      inset: 0;
      background: radial-gradient(ellipse at center, rgba(255, 240, 120, .95) 0%, rgba(255, 120, 0, .35) 42%, transparent 65%);
      z-index: 999;
      pointer-events: none;
      opacity: 0;
      will-change: opacity;
    }

    @keyframes camShake {
      0% {
        transform: translate(0, 0) rotate(0)
      }

      12% {
        transform: translate(-5px, 4px) rotate(-.6deg)
      }

      30% {
        transform: translate(5px, -3px) rotate(.5deg)
      }

      52% {
        transform: translate(-3px, 4px) rotate(-.35deg)
      }

      78% {
        transform: translate(3px, -1px) rotate(.2deg)
      }

      100% {
        transform: translate(0, 0) rotate(0)
      }
    }

    .shaking {
      animation: camShake .32s ease;
      will-change: transform;
    }

    @keyframes fadeUp {
      from {
        opacity: 0;
        transform: translateY(16px)
      }

      to {
        opacity: 1;
        transform: translateY(0)
      }
    }

    .fade-up {
      animation: fadeUp .38s ease forwards;
    }

    @keyframes popIn {
      from {
        opacity: 0;
        transform: scale(.88)
      }

      to {
        opacity: 1;
        transform: scale(1)
      }
    }

    .pop-in {
      animation: popIn .3s cubic-bezier(.34, 1.56, .64, 1) forwards;
    }

    .x-hit {
      color: #ffd040;
      text-shadow: 0 0 8px rgba(255, 210, 0, .5);
    }

    /* streak new badge */
    .streak-new {
      display: inline-block;
      font-size: .5rem;
      letter-spacing: .18em;
      text-transform: uppercase;
      background: rgba(180, 90, 255, .2);
      border: 1px solid rgba(180, 90, 255, .4);
      border-radius: 3px;
      padding: 1px 6px;
      color: #e0b0ff;
      margin-left: 6px;
      animation: fadeUp .4s ease forwards;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SCHÃœTZENPASS / XP SYSTEM
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .schuetzenpass {
      width: 100%;
      padding: 10px 14px 12px;
      background: linear-gradient(135deg, rgba(180, 130, 10, .12), rgba(100, 70, 5, .1));
      border: 1px solid rgba(200, 160, 20, .22);
      border-radius: 12px;
      margin: 8px 0 4px;
      position: relative;
      overflow: hidden;
    }

    .schuetzenpass::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent, rgba(220, 180, 40, .4) 50%, transparent);
    }

    .sp-hd {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 8px;
    }

    .sp-rank-lbl {
      font-size: .5rem;
      letter-spacing: .28em;
      text-transform: uppercase;
      color: rgba(200, 160, 40, .5);
      font-weight: 600;
    }

    .sp-rank-name {
      font-family: 'Bebas Neue', cursive;
      font-size: 1.1rem;
      letter-spacing: .12em;
      color: #f0c840;
      text-shadow: 0 0 12px rgba(240, 200, 64, .3);
    }

    .sp-xp-info {
      font-family: 'DM Mono', monospace;
      font-size: .72rem;
      color: rgba(200, 160, 60, .6);
    }

    .sp-progress-wrap {
      width: 100%;
      height: 8px;
      background: rgba(0, 0, 0, .4);
      border-radius: 4px;
      overflow: hidden;
      border: 1px solid rgba(200, 160, 20, .15);
    }

    .sp-progress-fill {
      height: 100%;
      border-radius: 4px;
      background: linear-gradient(90deg, #8a6010, #f0c840, #ffe080);
      transition: width .5s cubic-bezier(.34, 1.56, .64, 1);
      position: relative;
    }

    .sp-progress-fill::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(90deg, transparent 70%, rgba(255, 255, 255, .25));
    }

    .sp-rank-row {
      display: flex;
      justify-content: space-between;
      margin-top: 5px;
    }

    .sp-rank-cur {
      font-size: .48rem;
      letter-spacing: .14em;
      text-transform: uppercase;
      color: rgba(200, 160, 40, .45);
    }

    .sp-rank-next {
      font-size: .48rem;
      letter-spacing: .14em;
      text-transform: uppercase;
      color: rgba(200, 160, 40, .25);
    }

    /* XP float animation */
    @keyframes xpFloat {
      0% {
        opacity: 0;
        transform: translateY(0) scale(.8);
      }

      20% {
        opacity: 1;
        transform: translateY(-8px) scale(1.1);
      }

      80% {
        opacity: 1;
        transform: translateY(-32px) scale(1);
      }

      100% {
        opacity: 0;
        transform: translateY(-44px) scale(.9);
      }
    }

    .xp-pop {
      position: fixed;
      pointer-events: none;
      z-index: 9999;
      font-family: 'Bebas Neue', cursive;
      font-size: 1.6rem;
      letter-spacing: .1em;
      color: #ffd040;
      text-shadow: 0 0 12px rgba(255, 200, 0, .8), 0 2px 4px rgba(0, 0, 0, .6);
      animation: xpFloat 1.6s ease forwards;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LEADERBOARD SCREEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    #screenLeaderboard {
      justify-content: flex-start;
    }

    #screenLeaderboard .hdr {
      padding-bottom: 10px;
    }

    .lb-list {
      width: 100%;
      display: flex;
      flex-direction: column;
      gap: 7px;
    }

    .lb-xp {
      font-family: 'Bebas Neue', cursive;
      font-size: 1.1rem;
      color: #f0c840;
      text-shadow: 0 0 8px rgba(240, 200, 64, .25);
      flex-shrink: 0;
      text-align: right;
    }

    .lb-xp-lbl {
      font-size: .42rem;
      letter-spacing: .18em;
      text-transform: uppercase;
      color: rgba(240, 200, 64, .3);
      display: block;
    }

    .lb-row {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 10px 14px;
      background: rgba(0, 0, 0, .4);
      border: 1px solid rgba(255, 255, 255, .07);
      border-radius: 10px;
      transition: border-color .2s;
    }

    .lb-row.top1 {
      border-color: rgba(240, 200, 40, .35);
      background: linear-gradient(135deg, rgba(80, 55, 0, .4), rgba(40, 25, 0, .3));
    }

    .lb-row.top2 {
      border-color: rgba(190, 190, 190, .2);
      background: rgba(40, 40, 40, .3);
    }

    .lb-row.top3 {
      border-color: rgba(180, 100, 40, .2);
      background: rgba(50, 25, 10, .3);
    }

    .lb-pos {
      font-family: 'Bebas Neue', cursive;
      font-size: 1.4rem;
      color: rgba(255, 255, 255, .2);
      width: 24px;
      text-align: center;
      flex-shrink: 0;
    }

    .lb-row.top1 .lb-pos {
      color: #f0c840;
    }

    .lb-row.top2 .lb-pos {
      color: #c0c0c0;
    }

    .lb-row.top3 .lb-pos {
      color: #c87840;
    }

    .lb-info {
      flex: 1;
      min-width: 0;
    }

    .lb-name {
      font-size: .9rem;
      font-weight: 700;
      color: rgba(255, 255, 255, .8);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .lb-meta {
      font-size: .6rem;
      color: rgba(255, 255, 255, .25);
      letter-spacing: .08em;
      margin-top: 1px;
    }

    .lb-streak {
      font-family: 'Bebas Neue', cursive;
      font-size: 1.5rem;
      color: #c880ff;
      text-shadow: 0 0 10px rgba(180, 90, 255, .3);
      flex-shrink: 0;
    }

    .lb-streak-lbl {
      font-size: .42rem;
      letter-spacing: .18em;
      text-transform: uppercase;
      color: rgba(190, 140, 255, .3);
      text-align: right;
      display: block;
    }

    .lb-empty {
      text-align: center;
      padding: 40px 20px;
      color: rgba(255, 255, 255, .2);
      font-size: .85rem;
    }

    .lb-loading {
      text-align: center;
      padding: 30px;
      color: rgba(255, 255, 255, .25);
      font-size: .8rem;
      letter-spacing: .1em;
    }

    .lb-submit-row {
      width: 100%;
      display: flex;
      gap: 8px;
      margin-bottom: 4px;
    }

    .lb-name-inp {
      flex: 1;
      padding: 10px 12px;
      font-family: 'Outfit', sans-serif;
      font-size: .9rem;
      background: rgba(255, 255, 255, .05);
      border: 1px solid rgba(140, 200, 60, .2);
      border-radius: 9px;
      color: #c8ee80;
      outline: none;
    }

    .lb-name-inp::placeholder {
      color: rgba(255, 255, 255, .15);
    }

    .lb-name-inp:focus {
      border-color: #6aaa28;
    }

    .btn-lb-submit {
      padding: 10px 14px;
      font-weight: 700;
      font-size: .85rem;
      background: linear-gradient(135deg, #5a9020, #3a6010);
      color: #d8f8a0;
      border: none;
      border-radius: 9px;
      cursor: pointer;
      box-shadow: 0 3px 0 #1a3008;
      transition: transform .1s, box-shadow .1s;
      white-space: nowrap;
    }

    .btn-lb-submit:active {
      transform: translateY(2px);
      box-shadow: 0 1px 0 #1a3008;
    }

    .lb-my-best {
      width: 100%;
      padding: 10px 14px;
      background: rgba(170, 90, 255, .08);
      border: 1px solid rgba(170, 90, 255, .18);
      border-radius: 10px;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .lb-my-lbl {
      font-size: .52rem;
      letter-spacing: .22em;
      text-transform: uppercase;
      color: rgba(190, 140, 255, .4);
      font-weight: 600;
    }

    .lb-my-val {
      font-family: 'Bebas Neue', cursive;
      font-size: 1.5rem;
      color: #c880ff;
    }
  </style>
</head>

<body>
  <div id="muzzleFlash"></div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SETUP â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="screenSetup" class="screen active">
    <div class="hdr">
      <!-- Top row: streak left Â· logo center Â· spacer right -->
      <div class="hdr-top">
        <div class="streak-corner" id="streakCorner">
          <span class="sc-fire" id="scFire">ğŸ”¥</span>
          <div class="sc-inf">
            <div class="sc-n" id="scN">â€“</div>
            <div class="sc-lbl" id="scLbl">Streak</div>
          </div>
        </div>
        <div class="logo">SCHUSS<em>DUELL</em></div>
        <div class="hdr-spacer" aria-hidden="true">
          <div class="streak-corner" style="visibility:hidden;">
            <span class="sc-fire">ğŸ”¥</span>
            <div class="sc-inf">
              <div class="sc-n">0</div>
              <div class="sc-lbl">x</div>
            </div>
          </div>
        </div>
      </div>
      <div class="logo-tag" id="logoTag">Du vs. Bot Â· 40 Schuss Â· Wer trifft besser?</div>

      <!-- Weapon Tabs -->
      <div class="weapon-tabs" id="weaponTabs">
        <div class="weapon-tab active" id="wTabLG" onclick="switchWeapon('lg')">
          <div class="wt-name">ğŸŒ¬ï¸ Luftgewehr</div>
        </div>
        <div class="weapon-tab" id="wTabKK" onclick="switchWeapon('kk')">
          <div class="wt-name">ğŸ¯ KK</div>
        </div>
      </div>

      <!-- Discipline sub-tabs (dynamic per weapon) -->
      <div class="disc-tabs" id="discTabs" style="padding:10px 20px 0;"></div>

      <div class="hdr-tag" id="setupTag">â—† LUFTGEWEHR Â· LG 40 Â· 10 METER â—†</div>

      <!-- SchÃ¼tzenpass -->
      <div class="schuetzenpass" id="schuetzenpass">
        <div class="sp-hd">
          <div>
            <div class="sp-rank-lbl">â—ˆ SchÃ¼tzenpass</div>
            <div class="sp-rank-name" id="spRankName">AnfÃ¤nger</div>
          </div>
          <div style="text-align:right;">
            <div class="sp-xp-info"><span id="spXpCur">0</span> / <span id="spXpNext">100</span> XP</div>
            <button onclick="showScreen('screenLeaderboard');loadLeaderboard()"
              style="margin-top:3px;background:none;border:none;cursor:pointer;font-size:.62rem;letter-spacing:.16em;text-transform:uppercase;color:rgba(190,140,255,.45);padding:0;">ğŸ†
              Weltrangliste</button>
          </div>
        </div>
        <div class="sp-progress-wrap">
          <div class="sp-progress-fill" id="spFillBar" style="width:0%"></div>
        </div>
        <div class="sp-rank-row">
          <span class="sp-rank-cur" id="spRankCur">AnfÃ¤nger</span>
          <span class="sp-rank-next" id="spRankNext">â†’ SchÃ¼tze</span>
        </div>
      </div>
    </div>

    <div class="content">
      <!-- Distanz (wird bei 3x20 ausgeblendet da fix) -->
      <div class="card" id="distCard">
        <div class="card-hd">â—ˆ Distanz zur Scheibe</div>
        <div class="dist-row" id="distGroup">
          <button class="db active" data-dist="10" onclick="selDist(this)">
            <span class="db-n">10</span><span class="db-u">Meter</span>
          </button>
          <button class="db" data-dist="50" onclick="selDist(this)">
            <span class="db-n">50</span><span class="db-u">Meter</span>
          </button>
          <button class="db" data-dist="100" onclick="selDist(this)">
            <span class="db-n">100</span><span class="db-u">Meter</span>
          </button>
        </div>
      </div>

      <div class="info-row" id="distInfo">
        <span class="info-ico">ğŸ¯</span>
        <span class="info-txt"><b>10 Meter</b> â€“ Luftgewehr-Standarddistanz. HÃ¶chste PrÃ¤zision gefordert.</span>
      </div>

      <!-- Schwierigkeit -->
      <div class="card">
        <div class="card-hd">â—ˆ Bot-Schwierigkeit</div>
        <div class="diff-row" id="diffGroup">
          <button class="dif easy active" data-diff="easy" onclick="selDiff(this)">
            <span class="dif-ico">ğŸ˜Š</span>
            <span class="dif-name">Einfach</span>
            <span class="dif-desc">Kreisklasse</span>
          </button>
          <button class="dif real" data-diff="real" onclick="selDiff(this)">
            <span class="dif-ico">ğŸ¯</span>
            <span class="dif-name">Mittel</span>
            <span class="dif-desc">Bezirksliga</span>
          </button>
          <button class="dif hard" data-diff="hard" onclick="selDiff(this)">
            <span class="dif-ico">ğŸ’€</span>
            <span class="dif-name">Schwer</span>
            <span class="dif-desc">WM-Niveau</span>
          </button>
          <button class="dif elite" data-diff="elite" onclick="selDiff(this)">
            <span class="dif-ico">ğŸ’«</span>
            <span class="dif-name">Elite</span>
            <span class="dif-desc">Weltrekord</span>
          </button>
        </div>
      </div>

      <div class="info-row" id="diffInfo">
        <span class="info-ico">ğŸ˜Š</span>
        <span class="info-txt" id="diffInfoTxt"><b>Kreisklasse</b> â€“ GemÃ¼tlicher Einstieg. Aber unterschÃ¤tz den Bot
          nicht!</span>
      </div>

      <!-- Schussanzahl (ausgeblendet wenn Disziplin fixe Schusszahl vorgibt) -->
      <div class="card" id="shotCountCard">
        <div class="card-hd" id="shotCountHd">â—ˆ Anzahl SchÃ¼sse</div>
        <div class="sc-row" id="shotCountGroup">
          <button class="scb" data-shots="30" onclick="selShots(this)">
            <span class="scb-n">30</span><span class="scb-u">Schuss</span>
          </button>
          <button class="scb active" data-shots="40" onclick="selShots(this)">
            <span class="scb-n">40</span><span class="scb-u">Schuss</span>
          </button>
          <button class="scb" data-shots="60" onclick="selShots(this)">
            <span class="scb-n">60</span><span class="scb-u">Schuss</span>
          </button>
        </div>
      </div>

      <!-- 5er-Salve Option -->
      <button class="btn-burst" id="burstBtn" onclick="toggleBurst()">
        <span id="burstBtnTxt">ğŸ”« 5er-Salve: AUS</span>
        <span class="burst-badge" id="burstBadge">OPTIONAL</span>
      </button>
    </div>

    <div class="actions">
      <button class="btn-fire" onclick="startBattle()">ğŸ¯ &nbsp;DUELL STARTEN</button>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• BATTLE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="screenBattle" class="screen">
    <div class="hdr">
      <div style="width:100%;display:flex;align-items:center;justify-content:space-between;">
        <div class="logo" style="font-size:1.7rem;letter-spacing:.14em;">SCHUSS<em>DUELL</em></div>
        <!-- Match Timer -->
        <div class="match-timer-box" id="matchTimerBox">
          <span class="mt-ico">â±ï¸</span>
          <div class="mt-inf">
            <div class="mt-val" id="matchTimerVal">â€“:â€“â€“</div>
            <div class="mt-lbl">Restzeit</div>
          </div>
        </div>
      </div>
      <div class="hdr-chips">
        <div class="chip gold">
          <div class="chip-label">Ãœbrig</div>
          <div class="chip-val" id="shotsLeft">40</div>
          <div class="chip-sub">Schuss</div>
        </div>
        <div class="chip red" style="flex-direction:row;gap:2px;padding:6px 8px;min-width:unset;">
          <div style="display:flex;flex-direction:column;align-items:center;min-width:52px;">
            <div class="chip-label">Zehntel</div>
            <div class="chip-val" id="botScoreChip" style="font-size:1.25rem;color:#f08070;">0.0</div>
          </div>
          <div style="width:1px;background:rgba(255,255,255,.1);margin:4px 4px;align-self:stretch;"></div>
          <div style="display:flex;flex-direction:column;align-items:center;min-width:48px;">
            <div class="chip-label">Ganze</div>
            <div class="chip-val" id="botScoreChipInt" style="font-size:1.25rem;color:rgba(240,130,110,.5);">0</div>
          </div>
        </div>
      </div>
      <div class="hdr-tag" id="battleTag">â—† SCHUSS 1 / 40 â—†</div>
      <div class="diff-badge easy" id="battleBadge">ğŸ˜Š KREISKLASSE</div>
      <div class="weapon-badge lg" id="battleWeaponBadge" style="margin-bottom:8px;">ğŸŒ¬ï¸ LUFTGEWEHR</div>
    </div>

    <!-- Position Bar (3Ã—20 only) -->
    <div class="pos-bar" id="posBar">
      <div class="pos-item" id="posItem0">
        <div class="pi-done-check">âœ“</div>
        <div class="pi-ico">ğŸ¦µ</div>
        <div class="pi-name">Kniend</div>
        <div class="pi-shots" id="posShots0">0/20</div>
      </div>
      <div class="pos-item" id="posItem1">
        <div class="pi-done-check">âœ“</div>
        <div class="pi-ico">ğŸ›ï¸</div>
        <div class="pi-name">Liegend</div>
        <div class="pi-shots" id="posShots1">0/20</div>
      </div>
      <div class="pos-item" id="posItem2">
        <div class="pi-done-check">âœ“</div>
        <div class="pi-ico">ğŸ§</div>
        <div class="pi-name">Stehend</div>
        <div class="pi-shots" id="posShots2">0/20</div>
      </div>
    </div>

    <div class="content">
      <div class="target-wrap">
        <canvas id="targetCanvas"></canvas>
        <div class="target-shadow"></div>
      </div>

      <!-- Live dual-score bar -->
      <div class="live-score-bar">
        <div class="lsb-block">
          <div class="lsb-lbl">Bot Zehntel</div>
          <div class="lsb-val dec" id="lsbDec">0.0</div>
        </div>
        <div class="lsb-divider"></div>
        <div class="lsb-block">
          <div class="lsb-lbl">Bot Ganze</div>
          <div class="lsb-val int" id="lsbInt">0</div>
        </div>
        <div class="lsb-divider"></div>
        <div class="lsb-block">
          <div class="lsb-lbl">Hochrechnung</div>
          <div class="lsb-val proj" id="lsbProj">â€“</div>
        </div>
      </div>

      <!-- Shot log: scrollable grouped container -->
      <div class="shot-log-wrap" id="shotLogWrap">
        <!-- In 3x20 mode: populated with .sl-group divs per position -->
        <!-- In normal mode: flat .shot-log inside -->
        <div class="shot-log" id="shotLog"></div>
      </div>

      <!-- Last shot info -->
      <div class="last-shot-box">
        <div class="ls-txt" id="lastShotTxt"><b>Bereit!</b> DrÃ¼ck FEUER â€“ du schieÃŸt in der echten Welt, der Bot
          virtuell.</div>
      </div>

      <!-- Shot progress -->
      <div class="shot-progress">
        <div class="sp-row">
          <div class="sp-lbl" id="spLbl">Fortschritt</div>
          <div class="sp-count" id="spCount">0 / 40 Schuss</div>
        </div>
        <div class="sp-bar">
          <div class="sp-fill" id="spFill" style="width:0%"></div>
        </div>
        <!-- 3x20: per-position mini bar -->
        <div id="spPosRow" style="display:none;margin-top:4px;">
          <div class="sp-row" style="margin-bottom:3px;">
            <div class="sp-lbl" id="spPosLbl" style="color:rgba(140,220,60,.5);">Position</div>
            <div class="sp-count" id="spPosCount" style="font-size:.78rem;color:#a0e060;">0 / 20</div>
          </div>
          <div class="sp-bar" style="height:4px;">
            <div class="sp-fill" id="spPosFill" style="width:0%;background:linear-gradient(90deg,#3a8010,#80c830);">
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="actions">
      <button class="btn-fire" id="battleFireBtn" onclick="doBattleFire()">ğŸ”« &nbsp;FEUER!</button>
      <button class="btn-burst" id="battleBurstBtn" onclick="doBattleFire()" style="display:none;">âš¡ &nbsp;5 SCHUSS AUF
        EINMAL</button>
      <button class="btn-sec" onclick="endBattleEarly()">âœ• &nbsp;Alle SchÃ¼sse abgegeben â€“ Ergebnis eingeben</button>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• ENTRY â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="screenEntry" class="screen">
    <div class="hdr">
      <div class="logo" style="font-size:1.7rem;letter-spacing:.14em;">ERGEBNIS <em>EINGEBEN</em></div>
      <div class="logo-tag">Dein Ergebnis vs. Bot-Ergebnis</div>
      <div class="hdr-tag" id="entryTag">â—† 10 METER Â· 40 SCHUSS â—†</div>
    </div>

    <div class="content">
      <!-- Bot Ergebnis -->
      <div class="bot-result fade-up">
        <div class="br-lbl">ğŸ¤– Bot â€“ Gesamtpunkte</div>
        <div class="dual-wrap">
          <div class="dual-col">
            <div class="br-pts" id="botFinalPts">0.0</div>
            <span class="ds-dec-lbl" style="color:rgba(240,130,110,.5);">Zehntel</span>
          </div>
          <div style="color:rgba(255,255,255,.15);font-size:1.4rem;font-weight:300;">|</div>
          <div class="dual-col">
            <div class="br-pts" id="botFinalInt" style="font-size:2rem;color:rgba(240,130,110,.55);">0</div>
            <span class="ds-dec-lbl" style="color:rgba(240,130,110,.35);">Ganze</span>
          </div>
        </div>
        <div class="br-sub" id="botFinalDetail">aus 40 Schuss Â· Ã˜ â€“</div>
      </div>

      <!-- Eingabe -->
      <div class="entry-card2 fade-up">
        <div class="ec-lbl">â—ˆ Dein Ergebnis eingeben (mit Zehntel, z.B. 284.7)</div>
        <div class="ec-row">
          <input type="number" class="score-inp" id="playerInp" placeholder="0.0" min="0" max="400" step="0.1"
            inputmode="decimal" enterkeyhint="done" autocomplete="off" oninput="onPlayerInput()">
          <button class="btn-calc" onclick="calcResult()">âš¡ VERGLEICH</button>
        </div>
        <div class="auto-int" id="autoInt">â†’ Ganze Punkte: <span id="autoIntVal">â€“</span></div>
      </div>

      <div class="divider">
        <div class="divider-line"></div>
        <div class="divider-txt">oder direkt wÃ¤hlen</div>
        <div class="divider-line"></div>
      </div>

      <!-- Quick buttons -->
      <div class="quick-pair">
        <button class="btn-win" onclick="quickResult('win')">
          <span class="qb-ico">ğŸ†</span>
          <span class="qb-main">GEWONNEN</span>
          <span class="qb-sub">Mein Score &gt; Bot</span>
        </button>
        <button class="btn-lose" onclick="quickResult('lose')">
          <span class="qb-ico">ğŸ˜”</span>
          <span class="qb-main">VERLOREN</span>
          <span class="qb-sub">Bot Score &gt; Meiner</span>
        </button>
      </div>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• GAME OVER â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="screenOver" class="screen">
    <div class="go-emoji" id="goEmoji"></div>
    <div class="go-title" id="goTitle"></div>
    <div class="go-sub" id="goSub"></div>
    <div class="go-scores pop-in">
      <div class="gs-block">
        <div class="gs-who">ğŸ‘§ Du</div>
        <div class="gs-num you" id="goP">â€“</div>
        <div class="gs-unit" id="goPUnit" style="color:rgba(180,230,100,.4);">Zehntel</div>
        <div style="font-family:'DM Mono',monospace;font-size:1.2rem;color:rgba(180,230,100,.32);" id="goPInt">â€“</div>
        <div class="gs-unit" style="color:rgba(180,230,100,.22);">Ganze</div>
      </div>
      <div class="gs-sep">:</div>
      <div class="gs-block">
        <div class="gs-who">ğŸ¤– Bot</div>
        <div class="gs-num bot" id="goB">â€“</div>
        <div class="gs-unit" style="color:rgba(240,130,110,.4);">Zehntel</div>
        <div style="font-family:'DM Mono',monospace;font-size:1.2rem;color:rgba(240,130,110,.32);" id="goBInt">â€“</div>
        <div class="gs-unit" style="color:rgba(240,130,110,.22);">Ganze</div>
      </div>
    </div>
    <div class="go-reason" id="goReason"></div>
    <div class="go-margin" id="goMargin" style="display:none;"></div>
    <button class="btn-fire" style="max-width:320px;position:relative;z-index:1;" onclick="restartGame()">ğŸ”„
      &nbsp;NOCHMAL</button>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• LEADERBOARD â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="screenLeaderboard" class="screen">
    <div class="hdr">
      <div class="logo" style="font-size:1.7rem;letter-spacing:.14em;">ğŸ† WELT<em>RANGLISTE</em></div>
      <div class="logo-tag">Beste Streaks weltweit</div>
      <div class="hdr-tag">â—† TOP SCHÃœTZEN â—†</div>
    </div>

    <div class="content" style="padding-top:14px;">
      <!-- My best streak -->
      <div class="lb-my-best">
        <div>
          <div class="lb-my-lbl">Mein bester Streak</div>
          <div class="lb-my-val" id="lbMyBest">â€“</div>
        </div>
        <div style="flex:1;"></div>
        <div>
          <div class="lb-my-lbl">Meine XP</div>
          <div class="lb-my-val" id="lbMyXP" style="color:#f0c840;">â€“</div>
        </div>
      </div>

      <!-- Submit row -->
      <div class="lb-submit-row">
        <input type="text" class="lb-name-inp" id="lbNameInp" placeholder="Dein Name / KÃ¼rzel" maxlength="20"
          autocomplete="off">
        <button class="btn-lb-submit" onclick="submitToLeaderboard()">Eintragen</button>
      </div>

      <!-- Leaderboard list -->
      <div class="card" style="padding:12px 14px;">
        <div class="card-hd">â—ˆ Bestenliste â€“ LÃ¤ngste Siegesserien</div>
        <div class="lb-list" id="lbList">
          <div class="lb-loading">â³ Lade Rangliste...</div>
        </div>
      </div>
    </div>

    <div class="actions">
      <button class="btn-sec" style="color:rgba(140,200,60,.55);border-color:rgba(100,180,40,.2);"
        onclick="showScreen('screenSetup')">â† ZurÃ¼ck zum Spiel</button>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SCRIPT â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <script>
    /* â”€â”€â”€ STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    const G = {
      dist: '10', diff: 'easy',
      weapon: 'lg',          // 'lg' | 'kk'
      discipline: 'lg40',    // 'lg40' | 'lg60' | 'kk50' | 'kk100' | 'kk3x20'
      shots: 40,             // Schussanzahl (aus Disziplin oder manuell)
      burst: false,          // 5er-Salve Modus
      botShots: [], botTotal: 0, botTotalInt: 0,
      shotsLeft: 40, maxShots: 40,
      xp: 0,                 // XP-Stand
      streak: 0,             // Aktueller Streak (fÃ¼r Firebase)
      // 3Ã—20 position tracking
      is3x20: false,
      positions: [],         // ['Kniend','Liegend','Stehend']
      posIcons: [],          // emoji per position
      posIdx: 0,             // aktueller Positions-Index
      posShots: 0,           // SchÃ¼sse in aktueller Position
      perPos: 20,            // SchÃ¼sse pro Position
      posResults: [],        // Summe pro Position [{total, int, shots}]
      // Timer & Bot-Auto-Shoot
      _botInterval: null,    // setTimeout handle fÃ¼r Auto-Bot
      _timerInterval: null,  // setInterval handle fÃ¼r Countdown
      _timerSecsLeft: 0,     // verbleibende Sekunden
      _botStartTimeout: null, // setTimeout fÃ¼r verzÃ¶gerter Bot-Start nach Probe
      dnf: false,            // Did Not Finish (Zeit abgelaufen)
      // Probezeit
      probeActive: false,    // Probezeit ist aktiv
      probeSecsLeft: 0,      // Verbleibende Sekunden in Probezeit
      botStarted: false,     // Bot hat bereits zu schieÃŸen angefangen
    };

    /* â”€â”€â”€ DISZIPLIN CONFIG â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    const DISC = {
      // Luftgewehr
      lg40: {
        name: 'LG 40', weapon: 'lg', shots: 40, dist: '10', is3x20: false,
        timeMins: 50, desc: '40 Schuss Â· 50 Min', icon: 'ğŸ¯',
        info: '<b>LG 40</b> â€“ Klassische Luftgewehr-Disziplin. 40 Schuss auf 10 m. Zeitlimit: 50 Minuten.'
      },
      lg60: {
        name: 'LG 60', weapon: 'lg', shots: 60, dist: '10', is3x20: false,
        timeMins: 70, desc: '60 Schuss Â· 70 Min', icon: 'â­',
        info: '<b>LG 60</b> â€“ Erweiterte Luftgewehr-Disziplin. 60 Schuss auf 10 m. Zeitlimit: 70 Minuten.'
      },
      // KK
      kk50: {
        name: 'KK 50m', weapon: 'kk', shots: 60, dist: '50', is3x20: false,
        timeMins: 50, desc: '60 Schuss Â· 50 Min', icon: 'ğŸ¯',
        info: '<b>KK 60 / 50m</b> â€“ 60 Schuss KK auf 50 Meter. Zeitlimit: 50 Minuten.'
      },
      kk100: {
        name: 'KK 100m', weapon: 'kk', shots: 60, dist: '100', is3x20: false,
        timeMins: 70, desc: '60 Schuss Â· 70 Min', icon: 'ğŸ¯',
        info: '<b>KK 60 / 100m</b> â€“ 60 Schuss KK auf 100 Meter. Extreme PrÃ¤zision. Zeitlimit: 70 Minuten.'
      },
      kk3x20: {
        name: '3Ã—20 KK', weapon: 'kk', shots: 60, dist: '50', is3x20: true,
        timeMins: 160, desc: '3 Ã— 20 Schuss Â· 160 Min', icon: 'ğŸ†',
        positions: ['Kniend', 'Liegend', 'Stehend'], posIcons: ['ğŸ¦µ', 'ğŸ›ï¸', 'ğŸ§'],
        info: '<b>3Ã—20 KK</b> â€“ Je 20 Schuss kniend, liegend und stehend mit KK auf 50 m. Zeitlimit: 160 Minuten.'
      },
    };

    // Disziplinen pro Waffe
    const WEAPON_DISCS = {
      lg: ['lg40', 'lg60'],
      kk: ['kk50', 'kk100', 'kk3x20'],
    };

    /* â”€â”€â”€ CONFIG â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    const DIST_INFO = {
      lg: {
        '10': '<b>10 Meter</b> â€“ Luftgewehr-Standarddistanz. HÃ¶chste PrÃ¤zision gefordert.'
      },
      kk: {
        '50': '<b>50 Meter</b> â€“ KK-Standarddistanz. Klassische KÃ¶nigsdisziplin!',
        '100': '<b>100 Meter</b> â€“ Extreme KK-Distanz. Maximale Konzentration und Technik gefordert!'
      }
    };

    // Lebendige Dist-Info: wird von Disziplin Ã¼berschrieben wenn vorhanden
    function getDistInfo() { return DIST_INFO[G.weapon]?.[G.dist] || ''; }

    const SIGMA = { '10': 18, '50': 46, '100': 72 };
    const DIFF = {
      easy: {
        mult: 0.88, noise: 5, lbl: 'ğŸ˜Š KREISKLASSE', cls: 'easy',
        info: '<b>Kreisklasse</b> â€“ Solider Einstieg. ~310â€“340 Pkt. Schaffbar mit Konzentration!'
      },
      real: {
        mult: 0.52, noise: 2.5, lbl: 'ğŸ¯ BEZIRKSLIGA', cls: 'real',
        info: '<b>Bezirksliga</b> â€“ Fast nur 9er und 10er. ~355â€“375 Pkt. Kein Spaziergang!'
      },
      hard: {
        mult: 0.27, noise: 0.4, lbl: 'ğŸ’€ WM-NIVEAU', cls: 'hard',
        info: '<b>WM-Niveau</b> â€“ Trifft sehr prÃ¤zise. ~405â€“410 Pkt. Kaum zu schlagen!'
      },
      elite: {
        mult: 0.16, noise: 0.12, lbl: 'ğŸ’« WELTREKORD', cls: 'elite',
        info: '<b>Weltrekord-Bot</b> â€“ Immer â‰¥410 Zehntel. Extrem prÃ¤zise. Viel GlÃ¼ck!'
      }
    };

    // Disziplinspezifische Schwierigkeits-Infos
    const DIFF_INFO_BY_DISC = {
      // LG 60 hat hÃ¶here Punktwerte (1,5x von 40 zu 60 Schuss)
      lg60: {
        easy: '<b>Kreisklasse</b> â€“ Solider Einstieg. ~465â€“510 Pkt. Schaffbar mit Konzentration!',
        real: '<b>Bezirksliga</b> â€“ Fast nur 9er und 10er. ~533â€“563 Pkt. Kein Spaziergang!',
        hard: '<b>WM-Niveau</b> â€“ Trifft sehr prÃ¤zise. ~608â€“615 Pkt. Kaum zu schlagen!',
        elite: '<b>Weltrekord-Bot</b> â€“ Immer â‰¥615 Zehntel. Extrem prÃ¤zise. Viel GlÃ¼ck!'
      },
      // 3Ã—20 KK: Pro Position ~200 Punkte max, Gesamt ~600
      kk3x20: {
        easy: '<b>Kreisklasse</b> â€“ Solider Einstieg. Pro Position ~155â€“170 Pkt. Schaffbar mit Konzentration!',
        real: '<b>Bezirksliga</b> â€“ Fast nur 9er und 10er. Pro Position ~177â€“188 Pkt. Kein Spaziergang!',
        hard: '<b>WM-Niveau</b> â€“ Trifft sehr prÃ¤zise. Pro Position ~202â€“205 Pkt. Kaum zu schlagen!',
        elite: '<b>Weltrekord-Bot</b> â€“ Immer â‰¥205 Zehntel pro Position. Extrem prÃ¤zise. Viel GlÃ¼ck!'
      }
    };

    // Hilfsfunktion zum Abrufen der disziplinspezifischen Schwierigkeits-Info
    function getDiffInfo(diff) {
      const discSpecificInfos = DIFF_INFO_BY_DISC[G.discipline];
      if (discSpecificInfos && discSpecificInfos[diff]) {
        return discSpecificInfos[diff];
      }
      return DIFF[diff].info; // Fallback zu Standard-Info
    }

    const WEAPON_CFG = {
      lg: {
        icon: 'ğŸŒ¬ï¸', name: 'Luftgewehr', badgeCls: 'lg', defaultDist: '10',
        allowedDists: ['10'],
        setupTag: (disc, dist) => `â—† LUFTGEWEHR Â· ${DISC[disc]?.name || disc} Â· ${dist} METER â—†`
      },
      kk: {
        icon: 'ğŸ¯', name: 'KK', badgeCls: 'kk', defaultDist: '50',
        allowedDists: ['50', '100'],
        setupTag: (disc, dist) => `â—† KK Â· ${DISC[disc]?.name || disc} Â· ${dist} METER â—†`
      }
    };

    /* â”€â”€â”€ XP / RANKS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    const XP_PER_WIN = { easy: 10, real: 20, hard: 40, elite: 75 };
    const RANKS = [
      { name: 'AnfÃ¤nger', min: 0, max: 99, icon: 'ğŸ¯' },
      { name: 'SchÃ¼tze', min: 100, max: 299, icon: 'ğŸ”«' },
      { name: 'Fortgeschr.', min: 300, max: 599, icon: 'â­' },
      { name: 'Meister', min: 600, max: 999, icon: 'ğŸ…' },
      { name: 'GroÃŸmeister', min: 1000, max: 1999, icon: 'ğŸ†' },
      { name: 'Legende', min: 2000, max: Infinity, icon: 'ğŸ’«' }
    ];

    function getRank(xp) {
      for (let i = RANKS.length - 1; i >= 0; i--) {
        if (xp >= RANKS[i].min) return { rank: RANKS[i], idx: i };
      }
      return { rank: RANKS[0], idx: 0 };
    }

    function loadXP() {
      try { G.xp = parseInt(localStorage.getItem('sd_xp') || '0') || 0; }
      catch (e) { G.xp = 0; }
    }

    function saveXP() {
      try { localStorage.setItem('sd_xp', G.xp); }
      catch (e) { }
    }

    function awardXP(diff) {
      const gained = XP_PER_WIN[diff] || 10;
      G.xp += gained;
      saveXP();
      updateSchuetzenpass();
      showXPPop(gained);
      return gained;
    }

    function showXPPop(amount) {
      const el = document.createElement('div');
      el.className = 'xp-pop';
      el.textContent = '+' + amount + ' XP';
      el.style.left = (Math.random() * 40 + 30) + '%';
      el.style.top = '35%';
      document.body.appendChild(el);
      setTimeout(() => el.remove(), 1700);
    }

    function updateSchuetzenpass() {
      const { rank, idx } = getRank(G.xp);
      const nextRank = RANKS[idx + 1] || null;
      const xpInRank = G.xp - rank.min;
      const xpNeeded = nextRank ? (nextRank.min - rank.min) : 1;
      const pct = nextRank ? Math.min(100, (xpInRank / xpNeeded) * 100) : 100;

      DOM.spRankName.textContent = rank.icon + ' ' + rank.name;
      DOM.spRankCur.textContent = rank.name;
      DOM.spRankNext.textContent = nextRank ? 'â†’ ' + nextRank.name : 'âœ¦ MAX';
      DOM.spFillBar.style.width = pct + '%';
      DOM.spXpCur.textContent = G.xp - rank.min;
      DOM.spXpNext.textContent = nextRank ? (nextRank.min - rank.min) : 'âˆ';
    }

    /* â”€â”€â”€ FIREBASE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    // ğŸ”¥ ECHTE KONFIGURATION (aus deiner zweiten Datei)
    const FB_CONFIG = {
      apiKey: "AIzaSyDiwpW30GJW8da04A8ga9zOlj72PLXrUUk",
      authDomain: "burnished-block-402111.firebaseapp.com",
      databaseURL: "https://burnished-block-402111-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "burnished-block-402111",
      storageBucket: "burnished-block-402111.firebasestorage.app",
      messagingSenderId: "884784314045",
      appId: "1:884784314045:web:03c1af3dd3d91bfb2569d4"
    };

    let fbApp = null, fbDb = null, fbReady = false;

    function initFirebase() {
      try {
        if (!firebase || !firebase.apps) return;
        if (firebase.apps.length === 0) {
          fbApp = firebase.initializeApp(FB_CONFIG);
        } else {
          fbApp = firebase.apps[0];
        }
        fbDb = firebase.database(fbApp);
        fbReady = true;
      } catch (e) { console.warn('Firebase init failed:', e); fbReady = false; }
    }

    function loadLeaderboard() {
      const list = document.getElementById('lbList');
      if (!list) return;

      // Show local best on leaderboard screen
      const bestAll = Math.max(
        parseInt(localStorage.getItem('sd_lg_best') || '0') || 0,
        parseInt(localStorage.getItem('sd_kk_best') || '0') || 0
      );
      const el1 = document.getElementById('lbMyBest');
      const el2 = document.getElementById('lbMyXP');
      if (el1) el1.textContent = bestAll || 'â€“';
      if (el2) el2.textContent = G.xp || '0';

      if (!fbReady) {
        list.innerHTML = '<div class="lb-empty">ğŸ”Œ Offline â€“ Bestenliste nicht verfÃ¼gbar.<br><small style="opacity:.5">Firebase-Konfiguration in index.html eintragen.</small></div>';
        return;
      }

      list.innerHTML = '<div class="lb-loading">â³ Lade Rangliste...</div>';

      fbDb.ref('leaderboard').orderByChild('streak').limitToLast(20).once('value')
        .then(snap => {
          const entries = [];
          snap.forEach(child => { entries.push(child.val()); });
          entries.sort((a, b) => b.streak - a.streak);
          renderLeaderboard(entries);
        })
        .catch(() => {
          list.innerHTML = '<div class="lb-empty">âš ï¸ Fehler beim Laden.</div>';
        });
    }

    function renderLeaderboard(entries) {
      const list = document.getElementById('lbList');
      if (!list) return;
      if (!entries.length) {
        list.innerHTML = '<div class="lb-empty">Noch keine EintrÃ¤ge. Sei der Erste! ğŸ†</div>';
        return;
      }
      const medals = ['ğŸ¥‡', 'ğŸ¥ˆ', 'ğŸ¥‰'];
      list.innerHTML = entries.map((e, i) => {
        const cls = i === 0 ? 'top1' : i === 1 ? 'top2' : i === 2 ? 'top3' : '';
        const pos = i < 3 ? medals[i] : (i + 1);
        const weapon = e.weapon === 'kk' ? 'ğŸ¯ KK' : 'ğŸŒ¬ï¸ LG';
        return `<div class="lb-row ${cls}">
      <div class="lb-pos">${pos}</div>
      <div class="lb-info">
        <div class="lb-name">${escHtml(e.name || 'Anonym')}</div>
        <div class="lb-meta">${weapon} Â· ${e.date || ''}</div>
      </div>
      <div class="lb-xp">${e.xp || 0}<span class="lb-xp-lbl">XP</span></div>
      <div style="text-align:right;">
        <div class="lb-streak">ğŸ”¥${e.streak}</div>
        <span class="lb-streak-lbl">Best Streak</span>
      </div>
    </div>`;
      }).join('');
    }

    function escHtml(s) { return s.replace(/[&<>"']/g, c => ({ '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;' }[c])); }

    function submitToLeaderboard() {
      const nameInp = document.getElementById('lbNameInp');
      const name = (nameInp?.value || '').trim() || 'Anonym';

      const bestLG = parseInt(localStorage.getItem('sd_lg_best') || '0') || 0;
      const bestKK = parseInt(localStorage.getItem('sd_kk_best') || '0') || 0;
      const bestW = bestLG >= bestKK ? 'lg' : 'kk';
      const best = Math.max(bestLG, bestKK);

      if (best < 1) { alert('Noch keinen Streak! Spiele erst ein Duell.'); return; }
      if (!fbReady) { alert('Firebase nicht konfiguriert. Bitte FB_CONFIG in index.html eintragen.'); return; }

      // G.streak holds the current in-game streak value
      const currentStreak = STREAK_CACHE[G.weapon]?.streak || 0;

      const entry = {
        name: name.substring(0, 20),
        streak: best,
        currentStreak: currentStreak,
        weapon: bestW,
        xp: G.xp,
        date: new Date().toLocaleDateString('de-DE')
      };

      // Write to a named node so updates overwrite the previous entry for this user
      const safeUsername = name.substring(0, 20).replace(/[.#$\[\]]/g, '_');
      G.username = safeUsername;
      fbDb.ref('leaderboard/' + safeUsername).set(entry)
        .then(() => { loadLeaderboard(); })
        .catch(e => { alert('Fehler beim Eintragen: ' + e.message); });
    }
    const DOM = {};
    function initDOMCache() {
      const ids = [
        'shotsLeft', 'botScoreChip', 'botScoreChipInt',
        'lsbDec', 'lsbInt', 'lsbProj',
        'spFill', 'spCount', 'spLbl', 'spPosRow', 'spPosLbl', 'spPosCount', 'spPosFill',
        'battleTag', 'battleFireBtn', 'battleBurstBtn',
        'lastShotTxt', 'shotLog', 'shotLogWrap', 'muzzleFlash',
        'battleBadge', 'battleWeaponBadge',
        'distInfo', 'distCard', 'diffInfoTxt', 'setupTag', 'logoTag',
        'shotCountCard',
        'botFinalPts', 'botFinalInt', 'botFinalDetail',
        'playerInp', 'autoInt', 'autoIntVal', 'entryTag',
        'goP', 'goB', 'goPInt', 'goBInt', 'goPUnit', 'goTitle', 'goSub', 'goEmoji', 'goReason', 'goMargin',
        'wTabLG', 'wTabKK', 'discTabs',
        'posBar', 'posItem0', 'posItem1', 'posItem2', 'posShots0', 'posShots1', 'posShots2',
        'scFire', 'scN', 'scLbl',
        'burstBtn', 'burstBtnTxt', 'burstBadge',
        // SchÃ¼tzenpass elements
        'spRankName', 'spRankCur', 'spRankNext', 'spFillBar', 'spXpCur', 'spXpNext'
      ];
      ids.forEach(id => { DOM[id] = document.getElementById(id); });
      // slPills containers built dynamically â€” cached on startBattle
      DOM.slPills = [null, null, null];
    }

    /* â”€â”€â”€ CANVAS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    const canvas = document.getElementById('targetCanvas');
    const ctx = canvas.getContext('2d', { alpha: false });

    // Offscreen canvas: static target (rings, numbers, crosshairs) â€” drawn once per resize
    const _offCanvas = document.createElement('canvas');
    const _offCtx = _offCanvas.getContext('2d', { alpha: false });
    let _staticReady = false;

    function setSz() {
      const vw = Math.min(window.innerWidth, 420);
      const sz = Math.min(vw - 36, 270);
      canvas.width = sz; canvas.height = sz;
      _offCanvas.width = sz; _offCanvas.height = sz;
      _staticReady = false; // force redraw of static layer
    }

    /* Rings: [relR, fill, stroke, basePts, label] â€“ outer â†’ inner */
    const RINGS = [
      [1.00, '#f0ece0', '#c4bca4', 1, 'WeiÃŸ'],
      [0.85, '#f0ece0', '#b8b2a0', 2, 'WeiÃŸ'],
      [0.70, '#1c1c1c', '#383838', 3, 'Schwarz'],
      [0.57, '#1c1c1c', '#383838', 4, 'Schwarz'],
      [0.45, '#1a4db0', '#2268d8', 5, 'Blau'],
      [0.35, '#1a4db0', '#2268d8', 6, 'Blau'],
      [0.26, '#c01818', '#e83030', 7, 'Rot'],
      [0.18, '#c01818', '#e83030', 8, 'Rot'],
      [0.11, '#cca018', '#f0c030', 9, 'Gold'],
      [0.05, '#cca018', '#f0c030', 10, 'Bullseye']
    ];

    function buildStaticTarget() {
      const W = _offCanvas.width, H = _offCanvas.height, cx = W / 2, cy = H / 2, maxR = W / 2 - 2;
      const oc = _offCtx;

      const pg = oc.createRadialGradient(cx - maxR * .3, cy - maxR * .3, 0, cx, cy, maxR * 1.1);
      pg.addColorStop(0, '#faf4e2'); pg.addColorStop(1, '#e4dac0');
      oc.beginPath(); oc.arc(cx, cy, maxR, 0, Math.PI * 2); oc.fillStyle = pg; oc.fill();

      const es = oc.createRadialGradient(cx, cy, maxR * .75, cx, cy, maxR);
      es.addColorStop(0, 'transparent'); es.addColorStop(1, 'rgba(60,40,10,.3)');
      oc.beginPath(); oc.arc(cx, cy, maxR, 0, Math.PI * 2); oc.fillStyle = es; oc.fill();

      for (const [relR, fill, stroke] of RINGS) {
        const r = relR * maxR;
        oc.beginPath(); oc.arc(cx, cy, r, 0, Math.PI * 2);
        oc.fillStyle = fill; oc.fill();
        oc.strokeStyle = stroke; oc.lineWidth = 0.8; oc.stroke();
      }

      const xR = RINGS[9][0] * maxR * 0.55;
      oc.beginPath(); oc.arc(cx, cy, xR, 0, Math.PI * 2);
      oc.strokeStyle = 'rgba(255,200,0,.55)'; oc.lineWidth = 0.9; oc.stroke();
      oc.font = `600 ${maxR * .042}px Outfit,sans-serif`;
      oc.fillStyle = 'rgba(255,200,0,.6)'; oc.textAlign = 'center'; oc.textBaseline = 'middle';
      oc.fillText('X', cx + xR * .65, cy);

      const fs = maxR * .055;
      oc.font = `600 ${fs}px Outfit,sans-serif`;
      oc.textAlign = 'center'; oc.textBaseline = 'middle';
      const numColors = ['#999', '#999', '#bbb', '#bbb', '#8ab', '#8ab', '#f99', '#f99', '#fc4'];
      [[0.925], [0.775], [0.635], [0.51], [0.40], [0.305], [0.22], [0.145], [0.08]].forEach(([rel], i) => {
        const r = rel * maxR;
        oc.fillStyle = numColors[i];
        oc.fillText(RINGS[i][3], cx + r, cy);
        oc.fillText(RINGS[i][3], cx - r, cy);
      });

      oc.strokeStyle = 'rgba(0,0,0,.1)'; oc.lineWidth = 0.6; oc.setLineDash([2, 5]);
      oc.beginPath(); oc.moveTo(cx, cy - maxR); oc.lineTo(cx, cy + maxR); oc.stroke();
      oc.beginPath(); oc.moveTo(cx - maxR, cy); oc.lineTo(cx + maxR, cy); oc.stroke();
      oc.setLineDash([]);

      oc.beginPath(); oc.arc(cx, cy, maxR, 0, Math.PI * 2);
      oc.strokeStyle = 'rgba(160,140,80,.5)'; oc.lineWidth = 2; oc.stroke();

      _staticReady = true;
    }

    function drawTarget(shots) {
      const W = canvas.width, H = canvas.height, cx = W / 2, cy = H / 2, maxR = W / 2 - 2;
      if (!_staticReady) buildStaticTarget();
      // Blit static layer
      ctx.drawImage(_offCanvas, 0, 0);
      // Draw bullet holes on top
      if (shots && shots.length > 0) {
        for (const s of shots) {
          drawHole(cx + s.dx, cy + s.dy, maxR * .044, '#a00c0c', '#ff2828', s.cracks);
        }
      }
    }

    function drawHole(x, y, r, dark, glow, cracks) {
      const g = ctx.createRadialGradient(x, y, 0, x, y, r * 5);
      g.addColorStop(0, glow + '44'); g.addColorStop(1, 'transparent');
      ctx.beginPath(); ctx.arc(x, y, r * 5, 0, Math.PI * 2); ctx.fillStyle = g; ctx.fill();
      ctx.save(); ctx.translate(x, y); ctx.strokeStyle = 'rgba(0,0,0,.2)'; ctx.lineWidth = 0.5;
      const crackData = cracks || Array.from({ length: 7 }, (_, i) => ({ a: (i / 7) * Math.PI * 2, len: 1.7 }));
      for (const c of crackData) {
        ctx.beginPath(); ctx.moveTo(Math.cos(c.a) * r * .8, Math.sin(c.a) * r * .8);
        ctx.lineTo(Math.cos(c.a) * r * c.len, Math.sin(c.a) * r * c.len); ctx.stroke();
      }
      ctx.restore();
      const hg = ctx.createRadialGradient(x - r * .3, y - r * .3, 0, x, y, r);
      hg.addColorStop(0, '#160a0a'); hg.addColorStop(.6, '#040000'); hg.addColorStop(1, dark);
      ctx.beginPath(); ctx.arc(x, y, r, 0, Math.PI * 2); ctx.fillStyle = hg; ctx.fill();
      const rg = ctx.createRadialGradient(x - r * .3, y - r * .3, r * .5, x, y, r * 1.4);
      rg.addColorStop(0, glow); rg.addColorStop(.5, dark); rg.addColorStop(1, 'transparent');
      ctx.beginPath(); ctx.arc(x, y, r * 1.4, 0, Math.PI * 2); ctx.fillStyle = rg; ctx.globalAlpha = .5; ctx.fill(); ctx.globalAlpha = 1;
    }

    function gauss(s) {
      const u = Math.max(1e-10, Math.random());
      return s * Math.sqrt(-2 * Math.log(u)) * Math.cos(2 * Math.PI * Math.random());
    }

    /* â”€â”€â”€ SCORING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    function scoreHit(dx, dy) {
      const maxR = canvas.width / 2 - 2;
      const d = Math.sqrt(dx * dx + dy * dy);

      if (d > RINGS[0][0] * maxR) return { pts: 0, label: 'Daneben!', isX: false };

      let ringIdx = 0;
      for (let i = RINGS.length - 1; i >= 0; i--) {
        if (d <= RINGS[i][0] * maxR) { ringIdx = i; break; }
      }

      const basePts = RINGS[ringIdx][3];
      const outerR = RINGS[ringIdx][0] * maxR;
      const innerR = ringIdx + 1 < RINGS.length ? RINGS[ringIdx + 1][0] * maxR : 0;
      const ringW = outerR - innerR;
      const posInRing = ringW > 0 ? (outerR - d) / ringW : 1;

      const finalPts = Math.round(Math.min(10.9, basePts + posInRing * 0.9) * 10) / 10;

      const xR = RINGS[9][0] * maxR * 0.55;
      const isX = basePts === 10 && d <= xR;

      const label = isX ? 'âœ¦ Innenzehner (X)' : RINGS[ringIdx][4];
      return { pts: finalPts, label, isX };
    }

    function fmtPts(v) { return v.toFixed(1); }

    /* â”€â”€â”€ WEAPON + DISCIPLINE SWITCH â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    function switchWeapon(w) {
      if (G.weapon === w) return;
      G.weapon = w;
      DOM.wTabLG.classList.toggle('active', w === 'lg');
      DOM.wTabKK.classList.toggle('active', w === 'kk');
      // auto-select first discipline for this weapon
      const firstDisc = WEAPON_DISCS[w][0];
      buildDiscTabs(w);
      selDisc(firstDisc);
    }

    function buildDiscTabs(w) {
      const discs = WEAPON_DISCS[w];
      DOM.discTabs.innerHTML = discs.map(d => {
        const cfg = DISC[d];
        return `<div class="disc-tab${G.discipline === d ? ' active' : ''}" onclick="selDisc('${d}')">
      <div class="dt-name">${cfg.icon} ${cfg.name}</div>
      <div class="dt-desc">${cfg.desc}</div>
    </div>`;
      }).join('');
    }

    function selDisc(discKey) {
      const dc = DISC[discKey];
      if (!dc) return;
      G.discipline = discKey;
      G.weapon = dc.weapon;
      G.dist = dc.dist;
      G.shots = dc.shots;
      G.is3x20 = dc.is3x20;

      // Refresh disc tab active state
      DOM.discTabs.querySelectorAll('.disc-tab').forEach((el, i) => {
        el.classList.toggle('active', WEAPON_DISCS[G.weapon][i] === discKey);
      });

      // Distance card: hide for fixed-dist disciplines
      const cfg = WEAPON_CFG[G.weapon];
      document.querySelectorAll('#distGroup .db').forEach(btn => {
        const allowed = cfg.allowedDists.includes(btn.dataset.dist);
        btn.classList.toggle('hidden', !allowed);
        btn.classList.toggle('active', btn.dataset.dist === dc.dist);
      });
      // LG has only 10m, so hide the whole dist card
      if (DOM.distCard) DOM.distCard.style.display = G.weapon === 'lg' ? 'none' : '';

      // All disciplines have a fixed shot count â€” hide the manual selector always
      if (DOM.shotCountCard) DOM.shotCountCard.style.display = 'none';

      // Update info text
      if (DOM.distInfo) DOM.distInfo.querySelector('.info-txt').innerHTML = dc.info;
      DOM.setupTag.textContent = WEAPON_CFG[G.weapon].setupTag(discKey, dc.dist);
      DOM.logoTag.textContent = `Du vs. Bot Â· ${dc.name} Â· ${dc.shots} Schuss Â· Wer trifft besser?`;

      // Aktualisiere Schwierigkeitsinformation, falls bereits eine Schwierigkeit ausgewÃ¤hlt ist
      if (G.diff) {
        DOM.diffInfoTxt.innerHTML = getDiffInfo(G.diff);
      }

      updateStreakCorner(G.weapon);
    }

    /* â”€â”€â”€ SELECTORS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    function selDist(btn) {
      if (G.weapon === 'lg') return; // LG gesperrt auf 10 m
      document.querySelectorAll('#distGroup .db').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      G.dist = btn.dataset.dist;
      DOM.distInfo.querySelector('.info-txt').innerHTML = getDistInfo();
      DOM.setupTag.textContent = WEAPON_CFG[G.weapon].setupTag(G.discipline, G.dist);
    }

    function selDiff(btn) {
      document.querySelectorAll('#diffGroup .dif').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      G.diff = btn.dataset.diff;
      DOM.diffInfoTxt.innerHTML = getDiffInfo(G.diff);
    }

    function selShots(btn) {
      document.querySelectorAll('#shotCountGroup .scb').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      G.shots = parseInt(btn.dataset.shots);
      DOM.logoTag.textContent = `Du vs. Bot Â· ${DISC[G.discipline]?.name || G.discipline} Â· ${G.shots} Schuss Â· Wer trifft besser?`;
    }

    function toggleBurst() {
      G.burst = !G.burst;
      DOM.burstBtn.classList.toggle('on', G.burst);
      DOM.burstBtnTxt.textContent = G.burst ? 'ğŸ”« 5er-Salve: AN' : 'ğŸ”« 5er-Salve: AUS';
      DOM.burstBadge.textContent = G.burst ? 'AKTIV' : 'OPTIONAL';
    }

    /* â”€â”€â”€ STREAK (getrennt per Waffe) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
       Keys: sd_lg_streak / sd_kk_streak  etc.
       Streak-Corner zeigt immer die aktive Waffe
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€*/
    // In-memory streak cache (avoid repeated localStorage reads)
    const STREAK_CACHE = { lg: null, kk: null };

    function todayStr() {
      const d = new Date();
      return `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}-${String(d.getDate()).padStart(2, '0')}`;
    }

    function loadAllStreaks() {
      ['lg', 'kk'].forEach(w => loadStreakForWeapon(w));
      updateStreakCorner(G.weapon); // Show current weapon on startup
    }

    function loadStreakForWeapon(w) {
      try {
        const prefix = `sd_${w}_`;
        const last = localStorage.getItem(prefix + 'last_day') || '';
        let streak = parseInt(localStorage.getItem(prefix + 'streak') || '0');
        const best = parseInt(localStorage.getItem(prefix + 'best') || '0');
        const today = todayStr();
        let changed = false;

        if (last === '') {
          streak = 1; changed = true;
        } else {
          const diffDays = Math.round((new Date(today) - new Date(last)) / 86400000);
          if (diffDays === 1) { streak++; changed = true; }
          else if (diffDays > 1) { streak = 1; changed = true; }
          // diffDays === 0: same day, no write needed
        }

        if (changed) {
          localStorage.setItem(prefix + 'last_day', today);
          localStorage.setItem(prefix + 'streak', streak);
        }
        const nb = Math.max(streak, best);
        if (nb > best) localStorage.setItem(prefix + 'best', nb);

        STREAK_CACHE[w] = { streak, best: nb };
      } catch (e) {
        STREAK_CACHE[w] = { streak: 1, best: 1 };
      }
    }

    function updateStreakCorner(w) {
      const data = STREAK_CACHE[w];
      if (!data) return;
      const { streak } = data;
      const wName = WEAPON_CFG[w].name;
      DOM.scFire.textContent = streak >= 30 ? 'ğŸ”¥ğŸ”¥ğŸ”¥' : streak >= 14 ? 'ğŸ”¥ğŸ”¥' : 'ğŸ”¥';
      DOM.scN.textContent = streak;
      DOM.scLbl.textContent = w.toUpperCase() + ' Streak';
    }

    function updateWinStreak(won) {
      // This is called on game result â€” increment streak on win, reset on loss
      const w = G.weapon;
      const pfx = `sd_${w}_`;
      try {
        let streak = parseInt(localStorage.getItem(pfx + 'streak') || '0') || 0;
        const best = parseInt(localStorage.getItem(pfx + 'best') || '0') || 0;
        if (won) { streak++; } else { streak = 0; }
        localStorage.setItem(pfx + 'streak', streak);
        localStorage.setItem(pfx + 'best', Math.max(streak, best));
        STREAK_CACHE[w] = { streak, best: Math.max(streak, best), isNew: false };
        G.streak = streak; // Sync G.streak fÃ¼r Firebase
        updateStreakCorner(w);
        // Automatisch Streak + XP in Firebase sync wenn User eingeloggt
        if (fbReady && G.username) {
          fbDb.ref('leaderboard/' + G.username).update({
            streak: Math.max(streak, best),
            currentStreak: streak,
            xp: G.xp,
            date: new Date().toLocaleDateString('de-DE')
          }).catch(() => { });
        }
      } catch (e) { }
    }


    /* â”€â”€â”€ TIMER & BOT-INTERVAL HELPERS â”€â”€â”€â”€â”€â”€â”€â”€ */
    function clearBattleTimers() {
      if (G._botStartTimeout) { clearTimeout(G._botStartTimeout); G._botStartTimeout = null; }
      if (G._botInterval) { clearTimeout(G._botInterval); G._botInterval = null; }
      if (G._timerInterval) { clearInterval(G._timerInterval); G._timerInterval = null; }
    }

    function startMatchTimer(totalSecs) {
      G._timerSecsLeft = totalSecs;
      const box = document.getElementById('matchTimerBox');
      const val = document.getElementById('matchTimerVal');
      
      function tick() {
        // Probezeit-Info
        let timerDisp = '';
        if (G.probeActive && G.probeSecsLeft > 0) {
          const pm = Math.floor(G.probeSecsLeft / 60);
          const ps = G.probeSecsLeft % 60;
          timerDisp = `${pm}:${String(ps).padStart(2, '0')} (Probe)`;
          G.probeSecsLeft--;
        } else {
          // Probezeit beendet â†’ regulÃ¤re Zeit starten
          if (G.probeActive) {
            G.probeActive = false;
            DOM.lastShotTxt.innerHTML = 'âœ… <b>Probezeit beendet!</b> â€“ RegulÃ¤re Zeit gestartet.';
          }
          const m = Math.floor(G._timerSecsLeft / 60);
          const s = G._timerSecsLeft % 60;
          timerDisp = `${m}:${String(s).padStart(2, '0')}`;
          if (G._timerSecsLeft <= 0) {
            clearBattleTimers();
            // Zeit abgelaufen â†’ DNF
            G.dnf = true;
            if (val) val.textContent = '0:00';
            DOM.lastShotTxt.innerHTML = 'â° <b>Zeit abgelaufen!</b> DNF â€“ Das Duell ist beendet.';
            if (G.burst) DOM.battleBurstBtn.disabled = true;
            else DOM.battleFireBtn.disabled = true;
            setTimeout(() => goToEntry(), 1800);
            return;
          }
          G._timerSecsLeft--;
        }
        
        if (val) val.textContent = timerDisp;
        if (box) box.classList.toggle('warning', G._timerSecsLeft <= 300 && !G.probeActive); // Warnung ab 5 Min. (nach Probe)
      }
      tick(); // sofort anzeigen
      G._timerInterval = setInterval(tick, 1000);
    }

    function startBotAutoShoot() {
      function scheduleNextShot() {
        if (G._botInterval) clearTimeout(G._botInterval);

        // Wie viel Zeit hat der Bot im Durchschnitt pro Schuss?
        // (Zeit in Minuten * 60) / Anzahl der SchÃ¼sse
        const dc = DISC[G.discipline];
        const timeMins = dc.timeMins || 50;
        const avgTimePerShot = (timeMins * 60) / G.maxShots;

        // Bot-Timing: Nur Zeit-basiert, NICHT schwierigkeitsabhÃ¤ngig
        // Der Bot verteilt seine SchÃ¼sse gleichmÃ¤ÃŸig Ã¼ber die verfÃ¼gbare Zeit
        // Die Schwierigkeit beeinflusst nur die Genauigkeit, nicht das Timing
        const BOT_TIMING = {
          easy: { avgRatio: 0.80, rangeSecs: 15 },   // Nutzt etwa 80% der Zeit, etwas unbestÃ¤ndig
          real: { avgRatio: 0.80, rangeSecs: 15 },   // Nutzt etwa 80% der Zeit, solider Rhythmus
          hard: { avgRatio: 0.80, rangeSecs: 15 },   // Nutzt etwa 80% der Zeit, auch bei Profi
          elite: { avgRatio: 0.80, rangeSecs: 15 }   // Nutzt etwa 80% der Zeit, gleich wie andere
        };

        const cfg = BOT_TIMING[G.diff] || BOT_TIMING.real;

        // Zentrum des Rhythmus: So lange dauert ein "normaler" Schuss fÃ¼r diesen Bot
        const baseTime = avgTimePerShot * cfg.avgRatio;

        // ZufÃ¤llige Streuung abziehen oder addieren (variiert pro Schuss)
        // z.B. bei rangeSecs=15 weicht der Schuss zwischen -7.5s und +7.5s ab
        let randomSecs = (Math.random() * cfg.rangeSecs) - (cfg.rangeSecs / 2);

        // Finales Delay berechnen (nicht unter 5 Sekunden)
        const delaySecs = Math.max(5, baseTime + randomSecs);
        const delay = delaySecs * 1000;

        G._botInterval = setTimeout(() => {
          if (G.shotsLeft <= 0) return; // Spiel schon vorbei
          // Bot schieÃŸt automatisch einen Schuss (ohne Player-FX)
          botAutoFire();
          scheduleNextShot();
        }, delay);
      }
      scheduleNextShot();
    }

    function botAutoFire() {
      if (G.shotsLeft <= 0) return;
      const bRes = fireSingleShot();
      if (!bRes) return;

      // FÃ¼ge Pill zum Log hinzu
      const pillCls = bRes.isX ? 'x' : bRes.pts >= 9 ? 'hi' : bRes.pts >= 6 ? 'mid' : bRes.pts >= 1 ? 'lo' : 'miss';
      const pillTxt = bRes.isX ? `âœ¦${fmtPts(bRes.pts)}` : fmtPts(bRes.pts);
      if (G.is3x20) {
        const container = DOM.slPills[G.posIdx];
        if (container) {
          const pill = document.createElement('span');
          pill.className = 'sl-pill ' + pillCls;
          pill.textContent = pillTxt;
          container.appendChild(pill);
        }
        G.posShots++;
        G.posResults[G.posIdx].total = Math.round((G.posResults[G.posIdx].total + bRes.pts) * 10) / 10;
        G.posResults[G.posIdx].int += Math.floor(bRes.pts);
        if (G.posShots >= G.perPos && G.posIdx < G.positions.length - 1) {
          G.posIdx++; G.posShots = 0;
          setTimeout(() => updatePosBar(), 200);
        } else { updatePosBar(); }
        DOM.shotLogWrap.scrollTop = DOM.shotLogWrap.scrollHeight;
      } else {
        const pill = document.createElement('span');
        pill.className = 'sl-pill ' + pillCls;
        pill.textContent = 'ğŸ¤–' + pillTxt;
        DOM.shotLog.appendChild(pill);
        while (DOM.shotLog.children.length > 10) DOM.shotLog.removeChild(DOM.shotLog.firstChild);
      }

      // Info-Text aktualisieren
      DOM.lastShotTxt.innerHTML =
        `ğŸ¤– <b>Bot schieÃŸt automatisch!</b> ${bRes.label} Â· ${fmtPts(bRes.pts)} &nbsp;|&nbsp; Gesamt: <b>${fmtPts(G.botTotal)}</b> <span style="color:rgba(240,130,110,.45);font-size:.85em;">(${G.botTotalInt} ganze)</span>`;

      // Canvas + UI aktualisieren
      setTimeout(() => {
        drawTarget(G.botShots);
        updateBattleUI();
        if (G.shotsLeft <= 0) {
          clearBattleTimers();
          if (G.burst) DOM.battleBurstBtn.disabled = true;
          else DOM.battleFireBtn.disabled = true;
          DOM.battleTag.textContent = `â—† ${G.maxShots} SCHUSS ABGEFEUERT â—†`;
          DOM.lastShotTxt.innerHTML = `ğŸ Bot fertig! Gesamt: <b>${fmtPts(G.botTotal)} Punkte</b> aus ${G.maxShots} Schuss.`;
          setTimeout(() => goToEntry(), 1400);
        }
      }, 160);
    }

    function startBattle() {
      const dc = DISC[G.discipline];
      G.maxShots = dc.shots;
      G.shotsLeft = dc.shots;
      G.botShots = []; G.botTotal = 0; G.botTotalInt = 0;
      G.dnf = false;
      G.probeActive = true;  // Probezeit ist aktiv
      G.probeSecsLeft = 15 * 60;  // 15 Minuten Probezeit

      // Vorherige Timer/Intervalle aufrÃ¤umen
      clearBattleTimers();

      // 3Ã—20 init
      G.is3x20 = dc.is3x20;
      G.positions = dc.is3x20 ? [...dc.positions] : [];
      G.posIcons = dc.is3x20 ? [...dc.posIcons] : [];
      G.posIdx = 0;
      G.posShots = 0;
      G.perPos = 20;
      G.posResults = dc.is3x20 ? dc.positions.map(() => ({ total: 0, int: 0 })) : [];

      setSz(); drawTarget([]);

      // Reset shot log area
      DOM.shotLogWrap.innerHTML = '';
      if (G.is3x20) {
        G.positions.forEach((pos, i) => {
          const grp = document.createElement('div');
          grp.className = 'sl-group';
          grp.id = `slGroup${i}`;
          grp.innerHTML = `<div class="sl-group-hd">${G.posIcons[i]} ${pos}</div><div class="sl-group-pills" id="slPills${i}"></div>`;
          DOM.shotLogWrap.appendChild(grp);
          DOM.slPills[i] = null;
        });
        G.positions.forEach((_, i) => { DOM.slPills[i] = document.getElementById(`slPills${i}`); });
      } else {
        const flat = document.createElement('div');
        flat.className = 'shot-log';
        flat.id = 'shotLog';
        DOM.shotLogWrap.appendChild(flat);
        DOM.shotLog = flat;
      }

      DOM.lastShotTxt.innerHTML = G.is3x20
        ? `<b>Bereit!</b> Position 1: <b>${G.positions[0]}</b> Â· 20 SchÃ¼sse Â· Feuer frei!`
        : '<b>Bereit!</b> DrÃ¼ck FEUER â€“ du schieÃŸt in der echten Welt, der Bot schieÃŸt automatisch alle 20â€“45 Sek.';

      const diffCfg = DIFF[G.diff];
      const weapCfg = WEAPON_CFG[G.weapon];

      DOM.battleBadge.textContent = diffCfg.lbl;
      DOM.battleBadge.className = 'diff-badge ' + diffCfg.cls;
      DOM.battleWeaponBadge.textContent = weapCfg.icon + ' ' + dc.name.toUpperCase();
      DOM.battleWeaponBadge.className = 'weapon-badge ' + weapCfg.badgeCls;
      DOM.entryTag.textContent = `â—† ${G.dist} METER Â· ${dc.name} Â· ${G.maxShots} SCHUSS â—†`;

      DOM.posBar.classList.toggle('visible', G.is3x20);
      if (G.is3x20) updatePosBar();
      if (DOM.spPosRow) DOM.spPosRow.style.display = G.is3x20 ? '' : 'none';

      if (G.burst) {
        DOM.battleFireBtn.style.display = 'none';
        DOM.battleBurstBtn.style.display = '';
        DOM.battleBurstBtn.disabled = false;
      } else {
        DOM.battleFireBtn.style.display = '';
        DOM.battleBurstBtn.style.display = 'none';
      }

      updateBattleUI();
      showScreen('screenBattle');

      // Reset Bot-Start-Flag
      G.botStarted = false;

      // Auto-Start nach ~5 Sekunden Delay
      setTimeout(() => {
        // Match-Timer starten
        const timeMins = dc.timeMins || 50;
        startMatchTimer(timeMins * 60);

        // Bot-Auto-Shoot startet NACH Probezeit (15 Min spÃ¤ter)
        const probeDelayMs = (15 * 60 + 5) * 1000; // 15 Min Probezeit + 5 Sek Delay
        G._botStartTimeout = setTimeout(() => {
          if (!G.botStarted) {
            G.botStarted = true;
            startBotAutoShoot();
          }
        }, probeDelayMs);
      }, 5000);
    }

    function updateBattleUI() {
      const lowThresh = Math.max(5, Math.round(G.maxShots * 0.15));
      const low = G.shotsLeft <= lowThresh;
      const fired = G.maxShots - G.shotsLeft;

      // Score â€” compute once, assign to both score chip and live bar
      const totalFmt = fmtPts(G.botTotal);
      DOM.shotsLeft.textContent = G.shotsLeft;
      DOM.shotsLeft.className = low ? 'chip-val low' : 'chip-val';
      DOM.botScoreChip.textContent = totalFmt;
      DOM.botScoreChipInt.textContent = G.botTotalInt;
      DOM.lsbDec.textContent = totalFmt;
      DOM.lsbInt.textContent = G.botTotalInt;

      if (fired > 0) {
        DOM.lsbProj.textContent = '~' + fmtPts(Math.round((G.botTotal / fired) * G.maxShots * 10) / 10);
      } else {
        DOM.lsbProj.textContent = 'â€“';
      }

      // Overall progress bar
      DOM.spFill.style.width = ((fired / G.maxShots) * 100) + '%';
      DOM.spFill.className = low ? 'sp-fill low' : 'sp-fill';
      DOM.spCount.textContent = fired + ' / ' + G.maxShots + ' Schuss';
      DOM.spCount.className = low ? 'sp-count low' : 'sp-count';

      // 3Ã—20: per-position sub-bar
      if (G.is3x20 && DOM.spPosRow) {
        const posLow = (G.perPos - G.posShots) <= 4;
        DOM.spPosLbl.textContent = `${G.posIcons[G.posIdx] || ''} ${G.positions[G.posIdx] || ''}`;
        DOM.spPosCount.textContent = `${G.posShots} / ${G.perPos} Schuss`;
        DOM.spPosCount.style.color = posLow ? '#ff7040' : '#a0e060';
        DOM.spPosFill.style.width = ((G.posShots / G.perPos) * 100) + '%';
        DOM.spPosFill.style.background = posLow
          ? 'linear-gradient(90deg,#8a1010,#e04040)'
          : 'linear-gradient(90deg,#3a8010,#80c830)';
      }

      // Battle tag
      const allDone = fired >= G.maxShots;
      if (G.is3x20 && !allDone) {
        DOM.battleTag.textContent = `â—† ${(G.positions[G.posIdx] || '').toUpperCase()} Â· SCHUSS ${G.posShots + 1} / ${G.perPos} â—†`;
      } else {
        DOM.battleTag.textContent = allDone
          ? `â—† ${G.maxShots} SCHUSS ABGEFEUERT â—†`
          : `â—† SCHUSS ${fired + 1} / ${G.maxShots} â—†`;
      }

      if (G.burst) DOM.battleBurstBtn.disabled = G.shotsLeft <= 0;
      else DOM.battleFireBtn.disabled = G.shotsLeft <= 0;
    }

    function updatePosBar() {
      if (!G.is3x20) return;
      for (let i = 0; i < G.positions.length; i++) {
        const el = DOM[`posItem${i}`];
        const sh = DOM[`posShots${i}`];
        if (!el || !sh) continue;
        el.classList.remove('active', 'done', 'transition');
        if (i < G.posIdx) {
          el.classList.add('done');
          sh.textContent = G.posResults[i] ? fmtPts(G.posResults[i].total) : 'âœ“';
        } else if (i === G.posIdx) {
          el.classList.add('active');
          sh.textContent = G.posShots + '/' + G.perPos;
        } else {
          sh.textContent = '0/' + G.perPos;
        }
      }
    }

    function fireSingleShot() {
      if (G.shotsLeft <= 0) return;

      const dc = DIFF[G.diff];
      const sig = SIGMA[G.dist];
      const botSig = sig * dc.mult + dc.noise * Math.random();
      const bdx = gauss(botSig), bdy = gauss(botSig);
      const bRes = scoreHit(bdx, bdy);

      G.botShots.push({
        dx: bdx, dy: bdy, pts: bRes.pts, label: bRes.label, isX: bRes.isX,
        cracks: Array.from({ length: 7 }, (_, i) => ({
          a: (i / 7) * Math.PI * 2 + Math.random() * 0.7,
          len: 1.4 + Math.random()
        }))
      });
      G.botTotal = Math.round((G.botTotal + bRes.pts) * 10) / 10;
      G.botTotalInt += Math.floor(bRes.pts);
      G.shotsLeft--;
      return bRes;
    }

    function doBattleFire() {
      if (G.shotsLeft <= 0) return;

      // Probezeit beenden und Bot starten, wenn beim SchieÃŸen noch Probezeit aktiv ist
      if (G.probeActive) {
        G.probeActive = false;
        DOM.lastShotTxt.innerHTML = 'âœ… <b>Probezeit beendet!</b> â€“ RegulÃ¤re Zeit gestartet. Bot schieÃŸt jetzt!';
        
        // Abbrechen des verzÃ¶gerten Bot-Starts vom startBattle()
        if (G._botStartTimeout) {
          clearTimeout(G._botStartTimeout);
          G._botStartTimeout = null;
        }
        
        // Starte Bot-Auto-Shoot sofort (falls noch nicht gestartet)
        if (!G.botStarted) {
          if (G._botInterval) clearTimeout(G._botInterval);
          G.botStarted = true;
          startBotAutoShoot();
        }
      }

      const count = G.burst ? Math.min(5, G.shotsLeft) : 1;
      const results = [];
      for (let i = 0; i < count; i++) results.push(fireSingleShot());

      // FX
      const f = DOM.muzzleFlash;
      f.style.transition = 'none'; f.style.opacity = '1';
      setTimeout(() => { f.style.transition = 'opacity .22s'; f.style.opacity = '0'; }, 55);
      document.body.classList.remove('shaking');
      void document.body.offsetWidth;
      document.body.classList.add('shaking');
      setTimeout(() => document.body.classList.remove('shaking'), 320);

      // â”€â”€ Add pills to log â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      results.forEach(bRes => {
        const pillCls = bRes.isX ? 'x' : bRes.pts >= 9 ? 'hi' : bRes.pts >= 6 ? 'mid' : bRes.pts >= 1 ? 'lo' : 'miss';
        const pillTxt = bRes.isX ? `âœ¦${fmtPts(bRes.pts)}` : fmtPts(bRes.pts);

        if (G.is3x20) {
          // Add pill to current position group via cache
          const container = DOM.slPills[G.posIdx];
          if (container) {
            const pill = document.createElement('span');
            pill.className = 'sl-pill ' + pillCls;
            pill.textContent = pillTxt;
            container.appendChild(pill);
          }
          // Update position tracking
          G.posShots++;
          G.posResults[G.posIdx].total = Math.round((G.posResults[G.posIdx].total + bRes.pts) * 10) / 10;
          G.posResults[G.posIdx].int += Math.floor(bRes.pts);

          // Position complete?
          if (G.posShots >= G.perPos && G.posIdx < G.positions.length - 1) {
            const donePos = G.positions[G.posIdx];
            const doneRes = G.posResults[G.posIdx];
            DOM.lastShotTxt.innerHTML =
              `âœ… <b>${donePos}</b> abgeschlossen! Teilergebnis: <b>${fmtPts(doneRes.total)} Pkt</b><br>` +
              `â¡ï¸ Weiter mit <b>${G.positions[G.posIdx + 1]}</b>`;
            const nextEl = DOM[`posItem${G.posIdx + 1}`];
            if (nextEl) { nextEl.classList.add('transition'); setTimeout(() => nextEl.classList.remove('transition'), 450); }
            G.posIdx++;
            G.posShots = 0;
            setTimeout(() => updatePosBar(), 200);
          } else {
            updatePosBar();
          }
          DOM.shotLogWrap.scrollTop = DOM.shotLogWrap.scrollHeight;
        } else {
          // Flat log: show last 10
          const pill = document.createElement('span');
          pill.className = 'sl-pill ' + pillCls;
          pill.textContent = pillTxt;
          DOM.shotLog.appendChild(pill);
          while (DOM.shotLog.children.length > 10) DOM.shotLog.removeChild(DOM.shotLog.firstChild);
        }
      });

      // â”€â”€ Info text â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      if (count > 1) {
        const sumPts = results.reduce((a, r) => a + r.pts, 0);
        const xCount = results.filter(r => r.isX).length;
        const xStr = xCount > 0 ? ` Â· ${xCount}Ã— âœ¦X` : '';
        if (!G.is3x20) DOM.lastShotTxt.innerHTML =
          `âš¡ <b>5er-Salve</b>: +<b>${fmtPts(Math.round(sumPts * 10) / 10)}</b>${xStr} &nbsp;|&nbsp; Gesamt: <b>${fmtPts(G.botTotal)}</b> <span style="color:rgba(240,130,110,.45);font-size:.85em;">(${G.botTotalInt} ganze)</span>`;
      } else {
        const bRes = results[0];
        const emoji = bRes.isX ? 'âœ¦' : bRes.pts >= 9.5 ? 'ğŸ”¥' : bRes.pts >= 8 ? 'ğŸ’¥' : bRes.pts >= 6 ? 'ğŸ¯' : bRes.pts >= 4 ? 'ğŸ‘Œ' : bRes.pts >= 2 ? 'ğŸ˜¬' : 'ğŸ˜…';
        const scoreDisp = bRes.isX
          ? `<b style="color:#ffd040;">${bRes.label} Â· ${fmtPts(bRes.pts)}</b>`
          : `<b>${bRes.label} Â· ${fmtPts(bRes.pts)}</b>`;
        if (!G.is3x20 || G.posShots < G.perPos) // don't overwrite transition message
          DOM.lastShotTxt.innerHTML =
            `${emoji} ${scoreDisp} &nbsp;|&nbsp; Gesamt: <b>${fmtPts(G.botTotal)}</b> <span style="color:rgba(240,130,110,.45);font-size:.85em;">(${G.botTotalInt} ganze)</span>`;
      }

      setTimeout(() => {
        drawTarget(G.botShots);
        updateBattleUI();
        if (G.shotsLeft <= 0) {
          clearBattleTimers();
          if (G.burst) DOM.battleBurstBtn.disabled = true;
          else DOM.battleFireBtn.disabled = true;
          DOM.battleTag.textContent = `â—† ${G.maxShots} SCHUSS ABGEFEUERT â—†`;
          if (G.is3x20) {
            updatePosBar();
            DOM.lastShotTxt.innerHTML = `ğŸ Alle Positionen abgeschlossen! Bot-Gesamt: <b>${fmtPts(G.botTotal)} Pkt</b>`;
          } else {
            DOM.lastShotTxt.innerHTML = `ğŸ Bot fertig! Gesamt: <b>${fmtPts(G.botTotal)} Punkte</b> aus ${G.maxShots} Schuss.`;
          }
          setTimeout(() => goToEntry(), 1400);
        }
      }, 160);
    }

    function endBattleEarly() { clearBattleTimers(); goToEntry(); }

    function goToEntry() {
      DOM.botFinalPts.textContent = fmtPts(G.botTotal);
      DOM.botFinalInt.textContent = G.botTotalInt;
      const avg = G.botShots.length > 0 ? (G.botTotal / G.botShots.length).toFixed(1) : 'â€“';
      const xCount = G.botShots.filter(s => s.isX).length;
      const xStr = xCount > 0 ? ` Â· ${xCount}Ã— âœ¦X` : '';

      if (G.is3x20) {
        const parts = G.posResults.map((r, i) => `${G.posIcons[i]} ${fmtPts(r.total)}`).join('  ');
        DOM.botFinalDetail.textContent = `${parts} Â· Ã˜ ${avg} Pkt${xStr}`;
      } else {
        DOM.botFinalDetail.textContent = `aus ${G.botShots.length} Schuss Â· Ã˜ ${avg} Pkt${xStr}`;
      }
      DOM.playerInp.value = '';
      DOM.autoIntVal.textContent = 'â€“';
      DOM.autoInt.className = 'auto-int';
      showScreen('screenEntry');
    }
    function onPlayerInput() {
      const raw = DOM.playerInp.value;
      const val = parseFloat(raw);
      if (!isNaN(val) && val >= 0) {
        DOM.autoIntVal.textContent = Math.floor(val);
        DOM.autoInt.className = 'auto-int active';
      } else {
        DOM.autoIntVal.textContent = 'â€“';
        DOM.autoInt.className = 'auto-int';
      }
    }

    function calcResult() {
      const raw = DOM.playerInp.value;
      const val = parseFloat(raw);
      if (isNaN(val) || val < 0) { DOM.playerInp.focus(); return; }
      showGameOver(Math.round(val * 10) / 10, G.botTotal, null, Math.floor(val));
    }

    function quickResult(res) {
      if (res === 'win') showGameOver(G.botTotal + 0.1, G.botTotal, 'Schnellauswahl: Gewonnen', G.botTotalInt + 1);
      else showGameOver(Math.max(0, G.botTotal - 0.1), G.botTotal, 'Schnellauswahl: Verloren', Math.max(0, G.botTotalInt - 1));
    }

    function showGameOver(pp, bp, reason, ppInt) {
      DOM.goP.textContent = pp >= 0 ? fmtPts(pp) : 'â€“';
      DOM.goB.textContent = fmtPts(bp);
      DOM.goPInt.textContent = ppInt != null ? ppInt : (pp >= 0 ? Math.floor(pp) : 'â€“');
      DOM.goBInt.textContent = G.botTotalInt;
      DOM.goPUnit.textContent = pp >= 0 ? 'Zehntel' : '';

      const diffCfg = DIFF[G.diff];
      const discCfg = DISC[G.discipline];
      const xCount = G.botShots.filter(s => s.isX).length;
      const xStr = xCount > 0 ? ` Â· Bot: ${xCount}Ã— âœ¦X` : '';
      const dnfStr = G.dnf ? ' Â· â° DNF' : '';
      DOM.goReason.textContent = reason ||
        `${discCfg.name} Â· ${G.dist} m Â· ${diffCfg.lbl.replace(/[^\w\sâœ¦]/gi, '').trim()} Â· ${G.maxShots} Schuss${xStr}${dnfStr}`;

      const diff = Math.round((pp - bp) * 10) / 10;
      const absDiff = Math.abs(diff);
      const isElite = G.diff === 'elite';

      if (pp > bp) {
        DOM.goEmoji.textContent = isElite ? 'ğŸŒŸ' : 'ğŸ†';
        DOM.goTitle.textContent = 'DU GEWINNST!';
        DOM.goTitle.className = 'go-title win';
        DOM.goSub.textContent = isElite
          ? 'ğŸ¤¯ Weltrekord-Bot geschlagen! Absolut legendÃ¤r!'
          : 'ScharfschÃ¼tzin! Der Bot hatte keine Chance.';
        DOM.goMargin.textContent = `+${fmtPts(absDiff)} Punkte Vorsprung`;
        DOM.goMargin.className = 'go-margin win';
        DOM.goMargin.style.display = '';
        // Award XP (nur wenn kein DNF)
        if (!G.dnf) awardXP(G.diff);
        // Update streak win counter
        updateWinStreak(!G.dnf && pp > bp);
      } else if (bp > pp) {
        DOM.goEmoji.textContent = isElite ? 'ğŸ’«' : 'ğŸ¤–';
        DOM.goTitle.textContent = 'BOT GEWINNT!';
        DOM.goTitle.className = 'go-title lose';
        DOM.goSub.textContent = isElite
          ? 'Weltrekord-Niveau â€“ kaum zu schlagen. Respekt fÃ¼rs Versuchen!'
          : 'Nicht aufgeben â€“ ruf zur Revanche!';
        DOM.goMargin.textContent = `âˆ’${fmtPts(absDiff)} Punkte RÃ¼ckstand`;
        DOM.goMargin.className = 'go-margin lose';
        DOM.goMargin.style.display = '';
        updateWinStreak(false); // Streak fÃ¼r aktive Waffe auf 0 zurÃ¼cksetzen
      } else {
        DOM.goEmoji.textContent = 'ğŸ–ï¸';
        DOM.goTitle.textContent = 'UNENTSCHIEDEN!';
        DOM.goTitle.className = 'go-title draw';
        DOM.goSub.textContent = isElite ? 'Weltrekord-Bot auf AugenhÃ¶he â€“ bist du ein Roboter?!' : 'Was fÃ¼r ein ausgeglichenes Duell!';
        DOM.goMargin.textContent = 'Punktgleich!';
        DOM.goMargin.className = 'go-margin draw';
        DOM.goMargin.style.display = '';
        updateWinStreak(false); // Unentschieden zÃ¤hlt auch als Streak-Reset
      }
      showScreen('screenOver');
    }

    function restartGame() {
      clearBattleTimers();
      G.botShots = []; G.botTotal = 0; G.botTotalInt = 0;
      G.shotsLeft = G.shots; G.maxShots = G.shots;
      G.dnf = false;

      G.diff = 'easy';
      document.querySelectorAll('#diffGroup .dif').forEach(b => b.classList.remove('active'));
      document.querySelector('[data-diff="easy"]').classList.add('active');
      DOM.diffInfoTxt.innerHTML = getDiffInfo('easy');

      setSz(); drawTarget([]);
      showScreen('screenSetup');
    }

    function showScreen(id) {
      document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
      document.getElementById(id).classList.add('active');
    }

    /* â”€â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    initDOMCache();
    setSz();
    drawTarget([]);
    loadXP();
    updateSchuetzenpass();
    initFirebase();

    // Build initial discipline tabs for default weapon (lg)
    buildDiscTabs('lg');
    selDisc('lg40'); // sets dist, shots, hides/shows cards

    loadAllStreaks();

    let _rzTimer = null;
    window.addEventListener('resize', () => {
      if (_rzTimer) cancelAnimationFrame(_rzTimer);
      _rzTimer = requestAnimationFrame(() => { setSz(); drawTarget(G.botShots); });
    }, { passive: true });
  </script>
</body>

</html>